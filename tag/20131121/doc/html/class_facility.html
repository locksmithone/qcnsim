<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>QCNSim: Facility Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">QCNSim
   </div>
   <div id="projectbrief">Simulator for Quake-Catcher Network</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="class_facility-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">Facility Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><a class="el" href="class_facility.html" title="Facility class. ">Facility</a> class.  
 <a href="class_facility.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="_facility_8h_source.html">Facility.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for Facility:</div>
<div class="dyncontent">
 <div class="center">
  <img src="class_facility.png" usemap="#Facility_map" alt=""/>
  <map id="Facility_map" name="Facility_map">
<area href="class_entity.html" title="Entity class. " alt="Entity" shape="rect" coords="0,0,53,24"/>
</map>
 </div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a27cc99dd645a173e1398843273f98bec"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#a27cc99dd645a173e1398843273f98bec">Facility</a> (const std::string &amp;<a class="el" href="class_facility.html#a5967500c415fbf6b3bf420b58e645a6e">name</a>, unsigned int numberOfServers, <a class="el" href="class_simulator_globals.html">SimulatorGlobals</a> &amp;<a class="el" href="class_facility.html#a04cb8b8f3d633cfcf6ba1603f5dfe7ad">simulatorGlobals</a>, <a class="el" href="class_scheduler.html">Scheduler</a> &amp;<a class="el" href="class_facility.html#a36b590795f3752bd89a4a3ec5fa1307d">scheduler</a>)</td></tr>
<tr class="memdesc:a27cc99dd645a173e1398843273f98bec"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor with parameters.  <a href="#a27cc99dd645a173e1398843273f98bec">More...</a><br/></td></tr>
<tr class="separator:a27cc99dd645a173e1398843273f98bec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a97b0ad2a7e30361e105b6ed28e71cb"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#a1a97b0ad2a7e30361e105b6ed28e71cb">Facility</a> (const std::string &amp;<a class="el" href="class_facility.html#a5967500c415fbf6b3bf420b58e645a6e">name</a>, <a class="el" href="class_simulator_globals.html">SimulatorGlobals</a> &amp;<a class="el" href="class_facility.html#a04cb8b8f3d633cfcf6ba1603f5dfe7ad">simulatorGlobals</a>, <a class="el" href="class_scheduler.html">Scheduler</a> &amp;<a class="el" href="class_facility.html#a36b590795f3752bd89a4a3ec5fa1307d">scheduler</a>)</td></tr>
<tr class="separator:a1a97b0ad2a7e30361e105b6ed28e71cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8579e469df0909ad36ee6b0719a2173"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_facility_return_type_8h.html#a4ebe26bb7c3ad3b1926de74522fcc72c">FacilityReturnType</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#ad8579e469df0909ad36ee6b0719a2173">request</a> (std::shared_ptr&lt; const <a class="el" href="class_token.html">Token</a> &gt; token, <a class="el" href="_event_type_8h.html#a2628ea8d12e8b2563c32f05dc7fff6fa">EventType</a> eventType)</td></tr>
<tr class="separator:ad8579e469df0909ad36ee6b0719a2173"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3fbc8bb6b4a1f64d7ac2796df89eb05e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_facility_return_type_8h.html#a4ebe26bb7c3ad3b1926de74522fcc72c">FacilityReturnType</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#a3fbc8bb6b4a1f64d7ac2796df89eb05e">preempt</a> (std::shared_ptr&lt; const <a class="el" href="class_token.html">Token</a> &gt; token, <a class="el" href="_event_type_8h.html#a2628ea8d12e8b2563c32f05dc7fff6fa">EventType</a> eventType)</td></tr>
<tr class="separator:a3fbc8bb6b4a1f64d7ac2796df89eb05e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af3c20895dff840f8db94350070360e70"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_facility_return_type_8h.html#a4ebe26bb7c3ad3b1926de74522fcc72c">FacilityReturnType</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#af3c20895dff840f8db94350070360e70">release</a> (std::shared_ptr&lt; const <a class="el" href="class_token.html">Token</a> &gt; token)</td></tr>
<tr class="separator:af3c20895dff840f8db94350070360e70"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51a7f1911c56425bd1f341b3c2b005e0"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#a51a7f1911c56425bd1f341b3c2b005e0">isBusy</a> () const </td></tr>
<tr class="separator:a51a7f1911c56425bd1f341b3c2b005e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a648c145304ac37af293458ea11f674c3"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#a648c145304ac37af293458ea11f674c3">isUp</a> () const </td></tr>
<tr class="separator:a648c145304ac37af293458ea11f674c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9cf2c05d0966a731a8a9d9157a13df5e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#a9cf2c05d0966a731a8a9d9157a13df5e">setUp</a> ()</td></tr>
<tr class="separator:a9cf2c05d0966a731a8a9d9157a13df5e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f7671f75b0309c520692c2a210e734e"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#a0f7671f75b0309c520692c2a210e734e">setDown</a> ()</td></tr>
<tr class="separator:a0f7671f75b0309c520692c2a210e734e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a61f5bb8a3af86066d29dd2eeca3cdd84"><td class="memItemLeft" align="right" valign="top">std::list<br class="typebreak"/>
&lt; <a class="el" href="class_facility_queue_element.html">FacilityQueueElement</a> &gt;<br class="typebreak"/>
::size_type&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#a61f5bb8a3af86066d29dd2eeca3cdd84">getQueueSize</a> () const </td></tr>
<tr class="separator:a61f5bb8a3af86066d29dd2eeca3cdd84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4774c30a592bb2633877067028dc1717"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#a4774c30a592bb2633877067028dc1717">getUtilization</a> () const </td></tr>
<tr class="separator:a4774c30a592bb2633877067028dc1717"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acdb1662a8f2f36e360649a8f760ee096"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#acdb1662a8f2f36e360649a8f760ee096">getMeanBusyPeriod</a> () const </td></tr>
<tr class="memdesc:acdb1662a8f2f36e360649a8f760ee096"><td class="mdescLeft">&#160;</td><td class="mdescRight">See Jain, MacDougall.  <a href="#acdb1662a8f2f36e360649a8f760ee096">More...</a><br/></td></tr>
<tr class="separator:acdb1662a8f2f36e360649a8f760ee096"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abcd560ec9ba0694803e3ab23100ecbaa"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#abcd560ec9ba0694803e3ab23100ecbaa">getMeanBusyPeriod</a> (bool onlyFullyServiced) const </td></tr>
<tr class="memdesc:abcd560ec9ba0694803e3ab23100ecbaa"><td class="mdescLeft">&#160;</td><td class="mdescRight">See Jain, MacDougall.  <a href="#abcd560ec9ba0694803e3ab23100ecbaa">More...</a><br/></td></tr>
<tr class="separator:abcd560ec9ba0694803e3ab23100ecbaa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9fd474a9e15db535a7a05f5f1a44aba1"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#a9fd474a9e15db535a7a05f5f1a44aba1">getMeanQueueLength</a> () const </td></tr>
<tr class="memdesc:a9fd474a9e15db535a7a05f5f1a44aba1"><td class="mdescLeft">&#160;</td><td class="mdescRight">See Jain, MacDougall.  <a href="#a9fd474a9e15db535a7a05f5f1a44aba1">More...</a><br/></td></tr>
<tr class="separator:a9fd474a9e15db535a7a05f5f1a44aba1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad78afc03b5985c349e8a25bb3608c232"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#ad78afc03b5985c349e8a25bb3608c232">getName</a> () const </td></tr>
<tr class="separator:ad78afc03b5985c349e8a25bb3608c232"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ed30291bca3882e011216265f7d7462"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#a6ed30291bca3882e011216265f7d7462">getMaxRecordedQueueSize</a> () const </td></tr>
<tr class="separator:a6ed30291bca3882e011216265f7d7462"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af10ab3d08fb7342ee20f3002a8531717"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#af10ab3d08fb7342ee20f3002a8531717">getDequeuedTokensCount</a> () const </td></tr>
<tr class="separator:af10ab3d08fb7342ee20f3002a8531717"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a67cc29408dd53a988dcd7e2db7b7a4e8"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#a67cc29408dd53a988dcd7e2db7b7a4e8">getLastQueueChangeTime</a> () const </td></tr>
<tr class="separator:a67cc29408dd53a988dcd7e2db7b7a4e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d7afc7dca414dc23dd1ef324396c510"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#a9d7afc7dca414dc23dd1ef324396c510">getSumBusyTime</a> () const </td></tr>
<tr class="separator:a9d7afc7dca414dc23dd1ef324396c510"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a69b6c90815494efdffd9a643b092800e"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#a69b6c90815494efdffd9a643b092800e">getPreemptedTokensCount</a> () const </td></tr>
<tr class="separator:a69b6c90815494efdffd9a643b092800e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af893b9858d117fa8da34450b5c690d67"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#af893b9858d117fa8da34450b5c690d67">getSumLengthTimeProduct</a> () const </td></tr>
<tr class="separator:af893b9858d117fa8da34450b5c690d67"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a566a2efd483b20277d964b649d82acf8"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#a566a2efd483b20277d964b649d82acf8">getReleasedTokensCount</a> () const </td></tr>
<tr class="separator:a566a2efd483b20277d964b649d82acf8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d3183f02ce17ba8bd1544056a4ba3a9"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#a8d3183f02ce17ba8bd1544056a4ba3a9">getFullyServicedTokensCount</a> () const </td></tr>
<tr class="separator:a8d3183f02ce17ba8bd1544056a4ba3a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac1724d4f29211f7008a14c767f9dc359"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#ac1724d4f29211f7008a14c767f9dc359">getDroppedTokensCount</a> () const </td></tr>
<tr class="separator:ac1724d4f29211f7008a14c767f9dc359"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5b1017640e4313c95af773cf9d6606dd"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#a5b1017640e4313c95af773cf9d6606dd">getMeanServiceRate</a> () const </td></tr>
<tr class="separator:a5b1017640e4313c95af773cf9d6606dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad400821aba2cf4489c9b45534c2a42cd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#ad400821aba2cf4489c9b45534c2a42cd">setName</a> (const std::string &amp;<a class="el" href="class_facility.html#a5967500c415fbf6b3bf420b58e645a6e">name</a>)</td></tr>
<tr class="separator:ad400821aba2cf4489c9b45534c2a42cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af8a7f4d06884853b43de507d5dbad7a2"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#af8a7f4d06884853b43de507d5dbad7a2">getNumberOfServers</a> () const </td></tr>
<tr class="separator:af8a7f4d06884853b43de507d5dbad7a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36e512ba8667b6a2f62b131c3afca926"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#a36e512ba8667b6a2f62b131c3afca926">getRequestsPreemptsCount</a> () const </td></tr>
<tr class="separator:a36e512ba8667b6a2f62b131c3afca926"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4d8bbec743dae89da983619eedb2e129"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#a4d8bbec743dae89da983619eedb2e129">setQueueSizeLimit</a> (unsigned int limit)</td></tr>
<tr class="separator:a4d8bbec743dae89da983619eedb2e129"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ababbaa909332f3c55699721dc087f0c3"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#ababbaa909332f3c55699721dc087f0c3">getQueueSizeLimit</a> () const </td></tr>
<tr class="separator:ababbaa909332f3c55699721dc087f0c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_class_entity"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_class_entity')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="class_entity.html">Entity</a></td></tr>
<tr class="memitem:ac2da1e8a32161accc56f39ac52cebd86 inherit pub_methods_class_entity"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_entity.html#ac2da1e8a32161accc56f39ac52cebd86">~Entity</a> ()=0</td></tr>
<tr class="memdesc:ac2da1e8a32161accc56f39ac52cebd86 inherit pub_methods_class_entity"><td class="mdescLeft">&#160;</td><td class="mdescRight">Make this abstract (pure virtual), cannot be instantiated.  <a href="#ac2da1e8a32161accc56f39ac52cebd86">More...</a><br/></td></tr>
<tr class="separator:ac2da1e8a32161accc56f39ac52cebd86 inherit pub_methods_class_entity"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:ae701c2c3665891baa6929ef67ebd755b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#ae701c2c3665891baa6929ef67ebd755b">enqueue</a> (std::shared_ptr&lt; const <a class="el" href="class_token.html">Token</a> &gt; token, <a class="el" href="_event_type_8h.html#a2628ea8d12e8b2563c32f05dc7fff6fa">EventType</a> eventType, double serviceTime, bool isPreempted)</td></tr>
<tr class="separator:ae701c2c3665891baa6929ef67ebd755b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac1fb937bffd1530a130b68f7828a5d57"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#ac1fb937bffd1530a130b68f7828a5d57">dequeue</a> ()</td></tr>
<tr class="separator:ac1fb937bffd1530a130b68f7828a5d57"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac92cceb40d15ff27039f16ee83b8431a"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#ac92cceb40d15ff27039f16ee83b8431a">purgeQueue</a> ()</td></tr>
<tr class="memdesc:ac92cceb40d15ff27039f16ee83b8431a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Purge queue, return number of dropped elements.  <a href="#ac92cceb40d15ff27039f16ee83b8431a">More...</a><br/></td></tr>
<tr class="separator:ac92cceb40d15ff27039f16ee83b8431a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af7ceb3abf7be8d3712d9bb8f9841067c"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="class_facility_server.html">FacilityServer</a> &gt;<br class="typebreak"/>
::iterator&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#af7ceb3abf7be8d3712d9bb8f9841067c">nextFreeServer</a> ()</td></tr>
<tr class="separator:af7ceb3abf7be8d3712d9bb8f9841067c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1876f38a8faf1d5d45fcd005abf1da53"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="class_facility_server.html">FacilityServer</a> &gt;<br class="typebreak"/>
::const_iterator&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#a1876f38a8faf1d5d45fcd005abf1da53">nextFreeServer</a> () const </td></tr>
<tr class="separator:a1876f38a8faf1d5d45fcd005abf1da53"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31e9fbb87215bd9b292aa263150010d6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#a31e9fbb87215bd9b292aa263150010d6">initializeMembers</a> ()</td></tr>
<tr class="memdesc:a31e9fbb87215bd9b292aa263150010d6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize all facilities' member variables.  <a href="#a31e9fbb87215bd9b292aa263150010d6">More...</a><br/></td></tr>
<tr class="separator:a31e9fbb87215bd9b292aa263150010d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab95ab1d162a591087d3696b9712f7452"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#ab95ab1d162a591087d3696b9712f7452">dropTokensInService</a> ()</td></tr>
<tr class="separator:ab95ab1d162a591087d3696b9712f7452"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a5967500c415fbf6b3bf420b58e645a6e"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#a5967500c415fbf6b3bf420b58e645a6e">name</a></td></tr>
<tr class="memdesc:a5967500c415fbf6b3bf420b58e645a6e"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="class_facility.html" title="Facility class. ">Facility</a> name.  <a href="#a5967500c415fbf6b3bf420b58e645a6e">More...</a><br/></td></tr>
<tr class="separator:a5967500c415fbf6b3bf420b58e645a6e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab753210fbc2026ce45e73ec3c86ed75"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#aab753210fbc2026ce45e73ec3c86ed75">maxRecordedQueueSize</a></td></tr>
<tr class="memdesc:aab753210fbc2026ce45e73ec3c86ed75"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximum recorded queue size up to this moment.  <a href="#aab753210fbc2026ce45e73ec3c86ed75">More...</a><br/></td></tr>
<tr class="separator:aab753210fbc2026ce45e73ec3c86ed75"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1c5d07b106f295750da83ef6d31f7c34"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#a1c5d07b106f295750da83ef6d31f7c34">queueSizeLimit</a></td></tr>
<tr class="memdesc:a1c5d07b106f295750da83ef6d31f7c34"><td class="mdescLeft">&#160;</td><td class="mdescRight">The maximum size the queue can reach (default is std::numeric_limits&lt;unsigned int&gt;::max()); if reached, all requests for service will be dropped until queue decreases. Preemptions will be dropped if going into queue (see preempt function).  <a href="#a1c5d07b106f295750da83ef6d31f7c34">More...</a><br/></td></tr>
<tr class="separator:a1c5d07b106f295750da83ef6d31f7c34"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad175b4a1db5abafd76e28c67d81b99a4"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#ad175b4a1db5abafd76e28c67d81b99a4">dequeuedTokensCount</a></td></tr>
<tr class="memdesc:ad175b4a1db5abafd76e28c67d81b99a4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Count of dequeues up to this moment.  <a href="#ad175b4a1db5abafd76e28c67d81b99a4">More...</a><br/></td></tr>
<tr class="separator:ad175b4a1db5abafd76e28c67d81b99a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ecb5a0b0cc18479325d6c3a963972a2"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#a2ecb5a0b0cc18479325d6c3a963972a2">lastQueueChangeTime</a></td></tr>
<tr class="memdesc:a2ecb5a0b0cc18479325d6c3a963972a2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Absolute time of last queue change.  <a href="#a2ecb5a0b0cc18479325d6c3a963972a2">More...</a><br/></td></tr>
<tr class="separator:a2ecb5a0b0cc18479325d6c3a963972a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad85ff7fec4ac7166046cd65a80575def"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#ad85ff7fec4ac7166046cd65a80575def">sumBusyTime</a></td></tr>
<tr class="memdesc:ad85ff7fec4ac7166046cd65a80575def"><td class="mdescLeft">&#160;</td><td class="mdescRight">Total (relative, elapsed) time this facility was busy. Sum (integral) of busy time of all this facility's servers.  <a href="#ad85ff7fec4ac7166046cd65a80575def">More...</a><br/></td></tr>
<tr class="separator:ad85ff7fec4ac7166046cd65a80575def"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab1535255c93b31fe4cf63ecfcd48fc52"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#ab1535255c93b31fe4cf63ecfcd48fc52">preemptedTokensCount</a></td></tr>
<tr class="memdesc:ab1535255c93b31fe4cf63ecfcd48fc52"><td class="mdescLeft">&#160;</td><td class="mdescRight">Count of effective preemptions.  <a href="#ab1535255c93b31fe4cf63ecfcd48fc52">More...</a><br/></td></tr>
<tr class="separator:ab1535255c93b31fe4cf63ecfcd48fc52"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ef416b0d1a9ce5b719dc6499b16fa4b"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#a6ef416b0d1a9ce5b719dc6499b16fa4b">sumLengthTimeProduct</a></td></tr>
<tr class="memdesc:a6ef416b0d1a9ce5b719dc6499b16fa4b"><td class="mdescLeft">&#160;</td><td class="mdescRight">+= Current queue size * (currentAbsoluteTime - absolute time of last queue change); used to obtain average queue size.  <a href="#a6ef416b0d1a9ce5b719dc6499b16fa4b">More...</a><br/></td></tr>
<tr class="separator:a6ef416b0d1a9ce5b719dc6499b16fa4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a380f50651e6227b6f54ad20a020dba82"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#a380f50651e6227b6f54ad20a020dba82">releasedTokensCount</a></td></tr>
<tr class="memdesc:a380f50651e6227b6f54ad20a020dba82"><td class="mdescLeft">&#160;</td><td class="mdescRight">Count of processes which were served (released) by facility.  <a href="#a380f50651e6227b6f54ad20a020dba82">More...</a><br/></td></tr>
<tr class="separator:a380f50651e6227b6f54ad20a020dba82"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0519eef6d28a92c9b7a7d6a3bc9db31a"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="class_facility_server.html">FacilityServer</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#a0519eef6d28a92c9b7a7d6a3bc9db31a">servers</a></td></tr>
<tr class="memdesc:a0519eef6d28a92c9b7a7d6a3bc9db31a"><td class="mdescLeft">&#160;</td><td class="mdescRight">List of servers in this facility.  <a href="#a0519eef6d28a92c9b7a7d6a3bc9db31a">More...</a><br/></td></tr>
<tr class="separator:a0519eef6d28a92c9b7a7d6a3bc9db31a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4d45a968945045e44ea59be18dff74d1"><td class="memItemLeft" align="right" valign="top">std::list&lt; <a class="el" href="class_facility_queue_element.html">FacilityQueueElement</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#a4d45a968945045e44ea59be18dff74d1">queue</a></td></tr>
<tr class="memdesc:a4d45a968945045e44ea59be18dff74d1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Priority queue of tokens in this facility.  <a href="#a4d45a968945045e44ea59be18dff74d1">More...</a><br/></td></tr>
<tr class="separator:a4d45a968945045e44ea59be18dff74d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79363e2f35ebed14de6cf7b34bb96ecf"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#a79363e2f35ebed14de6cf7b34bb96ecf">isUp_</a></td></tr>
<tr class="memdesc:a79363e2f35ebed14de6cf7b34bb96ecf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Status of facility: true for up (operational), false for down (non-operational).  <a href="#a79363e2f35ebed14de6cf7b34bb96ecf">More...</a><br/></td></tr>
<tr class="separator:a79363e2f35ebed14de6cf7b34bb96ecf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab527ba2778f17a4068266fd8b522ec35"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#ab527ba2778f17a4068266fd8b522ec35">droppedTokensCount</a></td></tr>
<tr class="separator:ab527ba2778f17a4068266fd8b522ec35"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a04cb8b8f3d633cfcf6ba1603f5dfe7ad"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_simulator_globals.html">SimulatorGlobals</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#a04cb8b8f3d633cfcf6ba1603f5dfe7ad">simulatorGlobals</a></td></tr>
<tr class="memdesc:a04cb8b8f3d633cfcf6ba1603f5dfe7ad"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reference to <a class="el" href="class_simulator_globals.html" title="Simulator-scope variables and parameters. ">SimulatorGlobals</a> object (typically used to fetch the current clock time).  <a href="#a04cb8b8f3d633cfcf6ba1603f5dfe7ad">More...</a><br/></td></tr>
<tr class="separator:a04cb8b8f3d633cfcf6ba1603f5dfe7ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36b590795f3752bd89a4a3ec5fa1307d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_scheduler.html">Scheduler</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#a36b590795f3752bd89a4a3ec5fa1307d">scheduler</a></td></tr>
<tr class="memdesc:a36b590795f3752bd89a4a3ec5fa1307d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reference to <a class="el" href="class_scheduler.html" title="Scheduler class. ">Scheduler</a> object, such that dequeued tokens can be rescheduled.  <a href="#a36b590795f3752bd89a4a3ec5fa1307d">More...</a><br/></td></tr>
<tr class="separator:a36b590795f3752bd89a4a3ec5fa1307d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae813c0db5554a9827600e10cfc863748"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_facility.html#ae813c0db5554a9827600e10cfc863748">requestsPreemptsCount</a></td></tr>
<tr class="memdesc:ae813c0db5554a9827600e10cfc863748"><td class="mdescLeft">&#160;</td><td class="mdescRight">Count of number of service requests and preemptions made to this facility (regardless of the outcome). Notice that a token might have more than one request, e.g., if the first request finds a busy facility, token is enqueued. Dequeuing will generated another service request.  <a href="#ae813c0db5554a9827600e10cfc863748">More...</a><br/></td></tr>
<tr class="separator:ae813c0db5554a9827600e10cfc863748"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p><a class="el" href="class_facility.html" title="Facility class. ">Facility</a> class. </p>
<dl class="section user"><dt>Description</dt><dd>The <a class="el" href="class_facility.html" title="Facility class. ">Facility</a> class is used to model a resource or service center, i.e., something from which a process requests service. A facility consists of one or more servers and one priority queue, in which processes await access to the next available server. Only one process at a time can use a server. In the priority queue, processes are ordered from highest priority to lowest priority (default is zero). </dd></dl>

<p>Definition at line <a class="el" href="_facility_8h_source.html#l00044">44</a> of file <a class="el" href="_facility_8h_source.html">Facility.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a27cc99dd645a173e1398843273f98bec"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Facility::Facility </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>numberOfServers</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_simulator_globals.html">SimulatorGlobals</a> &amp;&#160;</td>
          <td class="paramname"><em>simulatorGlobals</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_scheduler.html">Scheduler</a> &amp;&#160;</td>
          <td class="paramname"><em>scheduler</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Constructor with parameters. </p>
<dl class="section author"><dt>Author</dt><dd>Marcos Portnoi </dd></dl>
<dl class="section date"><dt>Date</dt><dd>May 2013</dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>Copyright (C) 2013 University of Delaware. </dd>
<dd>
QCNSim uses elements of TARVOS simulator, Copyright (C) 2005, 2006, 2007 Marcos Portnoi. </dd></dl>
<dl class="section user"><dt></dt><dd>This file is part of QCNSim. QCNSim is free software: you can redistribute it and/or modify it under the terms of the GNU Lesser General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.<br/>
 QCNSim is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more details.<br/>
 You should have received a copy of the GNU Lesser General Public License along with QCNSim. If not, see <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>Name of <a class="el" href="class_facility.html" title="Facility class. ">Facility</a>. </td></tr>
    <tr><td class="paramname">numberOfServers</td><td>Number of servers in this facility. </td></tr>
    <tr><td class="paramname">simulatorGlobals</td><td><a class="el" href="class_simulator_globals.html" title="Simulator-scope variables and parameters. ">SimulatorGlobals</a> reference, typically used to get and update global values such as current clock time. </td></tr>
    <tr><td class="paramname">scheduler</td><td><a class="el" href="class_scheduler.html" title="Scheduler class. ">Scheduler</a> object reference, typically to allow for scheduling service a dequeued token. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00030">30</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;                                                                                                                               : <a class="code" href="class_facility.html#a5967500c415fbf6b3bf420b58e645a6e">name</a>(<a class="code" href="class_facility.html#a5967500c415fbf6b3bf420b58e645a6e">name</a>), <a class="code" href="class_facility.html#a04cb8b8f3d633cfcf6ba1603f5dfe7ad">simulatorGlobals</a>(simulatorGlobals), <a class="code" href="class_facility.html#a36b590795f3752bd89a4a3ec5fa1307d">scheduler</a>(scheduler) {</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    this-&gt;<a class="code" href="class_facility.html#a31e9fbb87215bd9b292aa263150010d6">initializeMembers</a>();</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; numberOfServers; ++i) {</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        <a class="code" href="class_facility.html#a0519eef6d28a92c9b7a7d6a3bc9db31a">servers</a>.push_back(<a class="code" href="class_facility_server.html">FacilityServer</a>());</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    }</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;}</div>
<div class="ttc" id="class_facility_html_a5967500c415fbf6b3bf420b58e645a6e"><div class="ttname"><a href="class_facility.html#a5967500c415fbf6b3bf420b58e645a6e">Facility::name</a></div><div class="ttdeci">std::string name</div><div class="ttdoc">Facility name. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00046">Facility.h:46</a></div></div>
<div class="ttc" id="class_facility_html_a04cb8b8f3d633cfcf6ba1603f5dfe7ad"><div class="ttname"><a href="class_facility.html#a04cb8b8f3d633cfcf6ba1603f5dfe7ad">Facility::simulatorGlobals</a></div><div class="ttdeci">SimulatorGlobals &amp; simulatorGlobals</div><div class="ttdoc">Reference to SimulatorGlobals object (typically used to fetch the current clock time). </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00065">Facility.h:65</a></div></div>
<div class="ttc" id="class_facility_server_html"><div class="ttname"><a href="class_facility_server.html">FacilityServer</a></div><div class="ttdoc">Facility Server class. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_server_8h_source.html#l00032">FacilityServer.h:32</a></div></div>
<div class="ttc" id="class_facility_html_a31e9fbb87215bd9b292aa263150010d6"><div class="ttname"><a href="class_facility.html#a31e9fbb87215bd9b292aa263150010d6">Facility::initializeMembers</a></div><div class="ttdeci">void initializeMembers()</div><div class="ttdoc">Initialize all facilities&amp;#39; member variables. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8cpp_source.html#l00055">Facility.cpp:55</a></div></div>
<div class="ttc" id="class_facility_html_a0519eef6d28a92c9b7a7d6a3bc9db31a"><div class="ttname"><a href="class_facility.html#a0519eef6d28a92c9b7a7d6a3bc9db31a">Facility::servers</a></div><div class="ttdeci">std::vector&lt; FacilityServer &gt; servers</div><div class="ttdoc">List of servers in this facility. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00059">Facility.h:59</a></div></div>
<div class="ttc" id="class_facility_html_a36b590795f3752bd89a4a3ec5fa1307d"><div class="ttname"><a href="class_facility.html#a36b590795f3752bd89a4a3ec5fa1307d">Facility::scheduler</a></div><div class="ttdeci">Scheduler &amp; scheduler</div><div class="ttdoc">Reference to Scheduler object, such that dequeued tokens can be rescheduled. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00066">Facility.h:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1a97b0ad2a7e30361e105b6ed28e71cb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Facility::Facility </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_simulator_globals.html">SimulatorGlobals</a> &amp;&#160;</td>
          <td class="paramname"><em>simulatorGlobals</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_scheduler.html">Scheduler</a> &amp;&#160;</td>
          <td class="paramname"><em>scheduler</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Constructor with name parameter.</p>
<p>Number of servers default to 1.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>Name of <a class="el" href="class_facility.html" title="Facility class. ">Facility</a>. </td></tr>
    <tr><td class="paramname">simulatorGlobals</td><td><a class="el" href="class_simulator_globals.html" title="Simulator-scope variables and parameters. ">SimulatorGlobals</a> reference, typically used to get and update global values such as current clock time. </td></tr>
    <tr><td class="paramname">scheduler</td><td><a class="el" href="class_scheduler.html" title="Scheduler class. ">Scheduler</a> object reference, typically to allow for scheduling service a dequeued token. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00047">47</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                                                                                                 : <a class="code" href="class_facility.html#a5967500c415fbf6b3bf420b58e645a6e">name</a>(<a class="code" href="class_facility.html#a5967500c415fbf6b3bf420b58e645a6e">name</a>), <a class="code" href="class_facility.html#a04cb8b8f3d633cfcf6ba1603f5dfe7ad">simulatorGlobals</a>(simulatorGlobals), <a class="code" href="class_facility.html#a36b590795f3752bd89a4a3ec5fa1307d">scheduler</a>(scheduler) {</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    this-&gt;<a class="code" href="class_facility.html#a31e9fbb87215bd9b292aa263150010d6">initializeMembers</a>();</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <a class="code" href="class_facility.html#a0519eef6d28a92c9b7a7d6a3bc9db31a">servers</a>.push_back(<a class="code" href="class_facility_server.html">FacilityServer</a>());</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;}</div>
<div class="ttc" id="class_facility_html_a5967500c415fbf6b3bf420b58e645a6e"><div class="ttname"><a href="class_facility.html#a5967500c415fbf6b3bf420b58e645a6e">Facility::name</a></div><div class="ttdeci">std::string name</div><div class="ttdoc">Facility name. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00046">Facility.h:46</a></div></div>
<div class="ttc" id="class_facility_html_a04cb8b8f3d633cfcf6ba1603f5dfe7ad"><div class="ttname"><a href="class_facility.html#a04cb8b8f3d633cfcf6ba1603f5dfe7ad">Facility::simulatorGlobals</a></div><div class="ttdeci">SimulatorGlobals &amp; simulatorGlobals</div><div class="ttdoc">Reference to SimulatorGlobals object (typically used to fetch the current clock time). </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00065">Facility.h:65</a></div></div>
<div class="ttc" id="class_facility_server_html"><div class="ttname"><a href="class_facility_server.html">FacilityServer</a></div><div class="ttdoc">Facility Server class. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_server_8h_source.html#l00032">FacilityServer.h:32</a></div></div>
<div class="ttc" id="class_facility_html_a31e9fbb87215bd9b292aa263150010d6"><div class="ttname"><a href="class_facility.html#a31e9fbb87215bd9b292aa263150010d6">Facility::initializeMembers</a></div><div class="ttdeci">void initializeMembers()</div><div class="ttdoc">Initialize all facilities&amp;#39; member variables. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8cpp_source.html#l00055">Facility.cpp:55</a></div></div>
<div class="ttc" id="class_facility_html_a0519eef6d28a92c9b7a7d6a3bc9db31a"><div class="ttname"><a href="class_facility.html#a0519eef6d28a92c9b7a7d6a3bc9db31a">Facility::servers</a></div><div class="ttdeci">std::vector&lt; FacilityServer &gt; servers</div><div class="ttdoc">List of servers in this facility. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00059">Facility.h:59</a></div></div>
<div class="ttc" id="class_facility_html_a36b590795f3752bd89a4a3ec5fa1307d"><div class="ttname"><a href="class_facility.html#a36b590795f3752bd89a4a3ec5fa1307d">Facility::scheduler</a></div><div class="ttdeci">Scheduler &amp; scheduler</div><div class="ttdoc">Reference to Scheduler object, such that dequeued tokens can be rescheduled. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00066">Facility.h:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="ac1fb937bffd1530a130b68f7828a5d57"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool Facility::dequeue </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Retrieves next token in queue and schedules service for it at the head of the event chain.</p>
<p>This function dequeues the token at the head of the queue and schedules a service request event for it, putting this event at the head of the event chain (such that this event is the very next to occur). Since the service request is being scheduled, and the token is not being put directly into service in this function, the function does not have to check whether there really is a free, available server (this is a sanity check, since there SHOULD be a free server when the dequeue function is called). These checks are done by the request function. The function also updates related statistics.</p>
<dl class="section return"><dt>Returns</dt><dd>True if a token was in fact successfully dequeued; false if no dequeue happened (typicall if the queue was empty). </dd></dl>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00174">174</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                       {</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="keywordflow">if</span> (! <a class="code" href="class_facility.html#a4d45a968945045e44ea59be18dff74d1">queue</a>.empty()) {</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="comment">// Queue not empty:  dequeue token, schedule event, and update queue statistics.</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <a class="code" href="class_facility.html#a6ef416b0d1a9ce5b719dc6499b16fa4b">sumLengthTimeProduct</a> += <a class="code" href="class_facility.html#a4d45a968945045e44ea59be18dff74d1">queue</a>.size() * (<a class="code" href="class_facility.html#a04cb8b8f3d633cfcf6ba1603f5dfe7ad">simulatorGlobals</a>.<a class="code" href="class_simulator_globals.html#a08da82e86d7c26d8f2498bd313f0e66e">getCurrentAbsoluteTime</a>() - <a class="code" href="class_facility.html#a2ecb5a0b0cc18479325d6c3a963972a2">lastQueueChangeTime</a>);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <a class="code" href="class_facility.html#a2ecb5a0b0cc18479325d6c3a963972a2">lastQueueChangeTime</a> = <a class="code" href="class_facility.html#a04cb8b8f3d633cfcf6ba1603f5dfe7ad">simulatorGlobals</a>.<a class="code" href="class_simulator_globals.html#a08da82e86d7c26d8f2498bd313f0e66e">getCurrentAbsoluteTime</a>();</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        ++<a class="code" href="class_facility.html#ad175b4a1db5abafd76e28c67d81b99a4">dequeuedTokensCount</a>;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="comment">// Schedule event for dequeued token, put in head of event chain (call special schedule function).</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <a class="code" href="class_facility.html#a36b590795f3752bd89a4a3ec5fa1307d">scheduler</a>.<a class="code" href="class_scheduler.html#a2efbb6f69464273b3ef92953d91018c9">scheduleFront</a>(<a class="code" href="class_event.html">Event</a>(0.0, <a class="code" href="class_facility.html#a4d45a968945045e44ea59be18dff74d1">queue</a>.front().eventType, <a class="code" href="class_facility.html#a4d45a968945045e44ea59be18dff74d1">queue</a>.front().token));</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <a class="code" href="class_facility.html#a4d45a968945045e44ea59be18dff74d1">queue</a>.pop_front(); <span class="comment">// Now actually remove first token from queue vector.</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// Done, token at queue will be put into service.</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// Nothing in queue.</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    }</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;}</div>
<div class="ttc" id="class_event_html"><div class="ttname"><a href="class_event.html">Event</a></div><div class="ttdoc">Event class. </div><div class="ttdef"><b>Definition:</b> <a href="_event_8h_source.html#l00035">Event.h:35</a></div></div>
<div class="ttc" id="class_facility_html_a4d45a968945045e44ea59be18dff74d1"><div class="ttname"><a href="class_facility.html#a4d45a968945045e44ea59be18dff74d1">Facility::queue</a></div><div class="ttdeci">std::list&lt; FacilityQueueElement &gt; queue</div><div class="ttdoc">Priority queue of tokens in this facility. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00060">Facility.h:60</a></div></div>
<div class="ttc" id="class_facility_html_a04cb8b8f3d633cfcf6ba1603f5dfe7ad"><div class="ttname"><a href="class_facility.html#a04cb8b8f3d633cfcf6ba1603f5dfe7ad">Facility::simulatorGlobals</a></div><div class="ttdeci">SimulatorGlobals &amp; simulatorGlobals</div><div class="ttdoc">Reference to SimulatorGlobals object (typically used to fetch the current clock time). </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00065">Facility.h:65</a></div></div>
<div class="ttc" id="class_facility_html_ad175b4a1db5abafd76e28c67d81b99a4"><div class="ttname"><a href="class_facility.html#ad175b4a1db5abafd76e28c67d81b99a4">Facility::dequeuedTokensCount</a></div><div class="ttdeci">unsigned int dequeuedTokensCount</div><div class="ttdoc">Count of dequeues up to this moment. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00053">Facility.h:53</a></div></div>
<div class="ttc" id="class_simulator_globals_html_a08da82e86d7c26d8f2498bd313f0e66e"><div class="ttname"><a href="class_simulator_globals.html#a08da82e86d7c26d8f2498bd313f0e66e">SimulatorGlobals::getCurrentAbsoluteTime</a></div><div class="ttdeci">double getCurrentAbsoluteTime() const </div><div class="ttdef"><b>Definition:</b> <a href="_simulator_globals_8cpp_source.html#l00070">SimulatorGlobals.cpp:70</a></div></div>
<div class="ttc" id="class_facility_html_a2ecb5a0b0cc18479325d6c3a963972a2"><div class="ttname"><a href="class_facility.html#a2ecb5a0b0cc18479325d6c3a963972a2">Facility::lastQueueChangeTime</a></div><div class="ttdeci">double lastQueueChangeTime</div><div class="ttdoc">Absolute time of last queue change. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00054">Facility.h:54</a></div></div>
<div class="ttc" id="class_facility_html_a6ef416b0d1a9ce5b719dc6499b16fa4b"><div class="ttname"><a href="class_facility.html#a6ef416b0d1a9ce5b719dc6499b16fa4b">Facility::sumLengthTimeProduct</a></div><div class="ttdeci">double sumLengthTimeProduct</div><div class="ttdoc">+= Current queue size * (currentAbsoluteTime - absolute time of last queue change); used to obtain av...</div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00057">Facility.h:57</a></div></div>
<div class="ttc" id="class_scheduler_html_a2efbb6f69464273b3ef92953d91018c9"><div class="ttname"><a href="class_scheduler.html#a2efbb6f69464273b3ef92953d91018c9">Scheduler::scheduleFront</a></div><div class="ttdeci">void scheduleFront(const Event &amp;event)</div><div class="ttdef"><b>Definition:</b> <a href="_scheduler_8cpp_source.html#l00083">Scheduler.cpp:83</a></div></div>
<div class="ttc" id="class_facility_html_a36b590795f3752bd89a4a3ec5fa1307d"><div class="ttname"><a href="class_facility.html#a36b590795f3752bd89a4a3ec5fa1307d">Facility::scheduler</a></div><div class="ttdeci">Scheduler &amp; scheduler</div><div class="ttdoc">Reference to Scheduler object, such that dequeued tokens can be rescheduled. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00066">Facility.h:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab95ab1d162a591087d3696b9712f7452"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int Facility::dropTokensInService </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Drop all tokens in service.</p>
<p>This function is typically called when a facility is put down. Then the current queue is purged, and all tokens currently in service must also be dropped. This function iterates through the list of servers; for every busy server, get the token, cancel future events for the token (release events), update statistics (e.g., busy time), and drop the token, making the server non-busy.\</p>
<dl class="section return"><dt>Returns</dt><dd>Number of tokens in service that were dropped. </dd></dl>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00967">967</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;                                           {</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    std::vector&lt;FacilityServer&gt;::iterator serversIterator;</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    serversIterator = <a class="code" href="class_facility.html#a0519eef6d28a92c9b7a7d6a3bc9db31a">servers</a>.begin();</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> droppedTokensHere = 0;</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    <span class="comment">// Iterate through the list of servers. For each busy server, cancel its token events (e.g., release events), update stats, drop token, make server non-busy.</span></div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    <span class="keywordflow">while</span> (serversIterator != <a class="code" href="class_facility.html#a0519eef6d28a92c9b7a7d6a3bc9db31a">servers</a>.end()) {</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;        <span class="keywordflow">if</span> (serversIterator-&gt;isBusy == <span class="keyword">true</span>) {</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;            <span class="comment">// Found busy server. Let&#39;s cancel events for the token being serviced.</span></div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;            <a class="code" href="class_facility.html#a36b590795f3752bd89a4a3ec5fa1307d">scheduler</a>.<a class="code" href="class_scheduler.html#ac09d9f9b4147c949268fa6bc66ced974">removeEvents</a>(serversIterator-&gt;token);</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;            serversIterator-&gt;isBusy = <span class="keyword">false</span>; <span class="comment">// Not busy anymore.</span></div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;            serversIterator-&gt;token.reset(); <span class="comment">// Clean the reference.</span></div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;            <span class="comment">// Update server stats.</span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;            serversIterator-&gt;sumBusyTime += <a class="code" href="class_facility.html#a04cb8b8f3d633cfcf6ba1603f5dfe7ad">simulatorGlobals</a>.<a class="code" href="class_simulator_globals.html#a08da82e86d7c26d8f2498bd313f0e66e">getCurrentAbsoluteTime</a>() - serversIterator-&gt;serviceStartTime; <span class="comment">// Acumulates busy time for this server.</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;            <span class="comment">// Update facility stats.</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;            this-&gt;<a class="code" href="class_facility.html#ad85ff7fec4ac7166046cd65a80575def">sumBusyTime</a> += <a class="code" href="class_facility.html#a04cb8b8f3d633cfcf6ba1603f5dfe7ad">simulatorGlobals</a>.<a class="code" href="class_simulator_globals.html#a08da82e86d7c26d8f2498bd313f0e66e">getCurrentAbsoluteTime</a>() - serversIterator-&gt;serviceStartTime; <span class="comment">// Acumulates busy time for facility.</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;            ++<a class="code" href="class_facility.html#ab527ba2778f17a4068266fd8b522ec35">droppedTokensCount</a>; <span class="comment">// Token was dropped; update global count.</span></div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;            ++droppedTokensHere; <span class="comment">// Update local count.</span></div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;        }</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;        ++serversIterator; <span class="comment">// Continue to next server.</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    }</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    <span class="keywordflow">return</span> droppedTokensHere;</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;}<div class="ttc" id="class_facility_html_ab527ba2778f17a4068266fd8b522ec35"><div class="ttname"><a href="class_facility.html#ab527ba2778f17a4068266fd8b522ec35">Facility::droppedTokensCount</a></div><div class="ttdeci">unsigned int droppedTokensCount</div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00062">Facility.h:62</a></div></div>
<div class="ttc" id="class_facility_html_a04cb8b8f3d633cfcf6ba1603f5dfe7ad"><div class="ttname"><a href="class_facility.html#a04cb8b8f3d633cfcf6ba1603f5dfe7ad">Facility::simulatorGlobals</a></div><div class="ttdeci">SimulatorGlobals &amp; simulatorGlobals</div><div class="ttdoc">Reference to SimulatorGlobals object (typically used to fetch the current clock time). </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00065">Facility.h:65</a></div></div>
<div class="ttc" id="class_scheduler_html_ac09d9f9b4147c949268fa6bc66ced974"><div class="ttname"><a href="class_scheduler.html#ac09d9f9b4147c949268fa6bc66ced974">Scheduler::removeEvents</a></div><div class="ttdeci">unsigned int removeEvents(std::shared_ptr&lt; const Entity &gt; entity)</div><div class="ttdef"><b>Definition:</b> <a href="_scheduler_8cpp_source.html#l00118">Scheduler.cpp:118</a></div></div>
<div class="ttc" id="class_simulator_globals_html_a08da82e86d7c26d8f2498bd313f0e66e"><div class="ttname"><a href="class_simulator_globals.html#a08da82e86d7c26d8f2498bd313f0e66e">SimulatorGlobals::getCurrentAbsoluteTime</a></div><div class="ttdeci">double getCurrentAbsoluteTime() const </div><div class="ttdef"><b>Definition:</b> <a href="_simulator_globals_8cpp_source.html#l00070">SimulatorGlobals.cpp:70</a></div></div>
<div class="ttc" id="class_facility_html_a0519eef6d28a92c9b7a7d6a3bc9db31a"><div class="ttname"><a href="class_facility.html#a0519eef6d28a92c9b7a7d6a3bc9db31a">Facility::servers</a></div><div class="ttdeci">std::vector&lt; FacilityServer &gt; servers</div><div class="ttdoc">List of servers in this facility. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00059">Facility.h:59</a></div></div>
<div class="ttc" id="class_facility_html_a36b590795f3752bd89a4a3ec5fa1307d"><div class="ttname"><a href="class_facility.html#a36b590795f3752bd89a4a3ec5fa1307d">Facility::scheduler</a></div><div class="ttdeci">Scheduler &amp; scheduler</div><div class="ttdoc">Reference to Scheduler object, such that dequeued tokens can be rescheduled. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00066">Facility.h:66</a></div></div>
<div class="ttc" id="class_facility_html_ad85ff7fec4ac7166046cd65a80575def"><div class="ttname"><a href="class_facility.html#ad85ff7fec4ac7166046cd65a80575def">Facility::sumBusyTime</a></div><div class="ttdeci">double sumBusyTime</div><div class="ttdoc">Total (relative, elapsed) time this facility was busy. Sum (integral) of busy time of all this facili...</div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00055">Facility.h:55</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae701c2c3665891baa6929ef67ebd755b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Facility::enqueue </td>
          <td>(</td>
          <td class="paramtype">std::shared_ptr&lt; const <a class="el" href="class_token.html">Token</a> &gt;&#160;</td>
          <td class="paramname"><em>token</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_event_type_8h.html#a2628ea8d12e8b2563c32f05dc7fff6fa">EventType</a>&#160;</td>
          <td class="paramname"><em>eventType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>serviceTime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>isPreempted</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Put tokens in queue, in order of highest (numeric) priority.</p>
<p>Tokens with same priority will go into the queue in FIFO manner (after other tokens of same priority). See dequeue for explanation on the <a class="el" href="class_event.html" title="Event class. ">Event</a> Type.</p>
<p>There are two approaches that can be used when requesting service and enqueueing tokens: (1) In TARVOS's (<a href="http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.122.4620">http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.122.4620</a>) approach, a request for service for a token scheduled with the service time and next event to be scheduled once the service is finished. If the facility is busy, the token is enqueued with the service time and next event. Upon dequeuing, all the information needed to put the token into service is present in the queue: the service time and the next event. The token is put into service immediately, bypassing the scheduler, and the next event is scheduled (typically a release event). A disadvantage of this approach is that dynamicity is lost for service times. Once the service time is recorded with the token when enqueueing, it will not change regardless of the time at which the token will be actually put into service. E.g., a facility might have dynamic performance: when the service was requested, the facility was operating at a certain mean service time s. The token was enqueued (since the facility was busy), and when the token is effectively put into service, the facility might be operating at a faster mean service time 2s. Since the service time was recorded and frozen the token was enqueued, the token will not benefit from a faster facility when it is actually serviced. (2) In SMPL approach, the token is enqueued with the current event with which it was scheduled. Upon dequeuing, this event is rescheduled for the token and put at the front of the event chain (a 0.0 time scheduling), such that it is the first event to occur next. The advantage of this approach is that now service will be requested for the token with whatever current mean service time, and even the treatment of the event might have changed during the period the token was in the queue. This approach is thus more dynamic. However, attention must be taken when calculating certain statistics, such as arrivals in a facility. If an arrival is counted when service is requested, then an enqueued token will result in two arrivals counted (one when it is first requested, and a second when the event is re-scheduled upon dequeuing).</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000004">Todo:</a></b></dt><dd>Verify TARVOS's statistics processing here. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">token</td><td><a class="el" href="class_token.html" title="Token class. ">Token</a> to be enqueued. </td></tr>
    <tr><td class="paramname">eventType</td><td><a class="el" href="class_event.html" title="Event class. ">Event</a> type associated with this token. Necessary for re-scheduling token upon dequeuing. </td></tr>
    <tr><td class="paramname">serviceTime</td><td>Service time of this token. It can be the remaining service time if the token was in service and was preempted (thus sent back to queue). For blocked tokens (i.e., tokens to which service did not yet begin), use serviceTime = 0.0. </td></tr>
    <tr><td class="paramname">isPreempted</td><td>True if this token to be enqueued was preempted; false if it was blocked. Based on this flag, this function will decide at which position to place the token in the queue: _ if preempted (true), then the token will be in front of tokens of same priority. _ if blocked (false), then the token will be behind tokens of same priority. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00108">108</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                                                                                                                  {</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="comment">// Update statistics *before* modifying queue.  See Jain for explanation.</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <a class="code" href="class_facility.html#a6ef416b0d1a9ce5b719dc6499b16fa4b">sumLengthTimeProduct</a> += <a class="code" href="class_facility.html#a4d45a968945045e44ea59be18dff74d1">queue</a>.size() * (<a class="code" href="class_facility.html#a04cb8b8f3d633cfcf6ba1603f5dfe7ad">simulatorGlobals</a>.<a class="code" href="class_simulator_globals.html#a08da82e86d7c26d8f2498bd313f0e66e">getCurrentAbsoluteTime</a>() - <a class="code" href="class_facility.html#a2ecb5a0b0cc18479325d6c3a963972a2">lastQueueChangeTime</a>);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <a class="code" href="class_facility.html#a2ecb5a0b0cc18479325d6c3a963972a2">lastQueueChangeTime</a> = <a class="code" href="class_facility.html#a04cb8b8f3d633cfcf6ba1603f5dfe7ad">simulatorGlobals</a>.<a class="code" href="class_simulator_globals.html#a08da82e86d7c26d8f2498bd313f0e66e">getCurrentAbsoluteTime</a>();</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="comment">// Insert this token in the queue with the event type and remaining service time.</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="comment">// If isPreempted is false, then it signifies the token is blocked, i.e., service has not yet begun for this token;</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="comment">// when dequeuing, the event associated with the token must be re-scheduled.</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="comment">// If isPreempted is true, then the token was preempted, and it will be put ahead of tokens of same priority in the queue</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="comment">// (but not ahead of tokens of higher priority).</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    std::list&lt;FacilityQueueElement&gt;::iterator queueIterator = <a class="code" href="class_facility.html#a4d45a968945045e44ea59be18dff74d1">queue</a>.begin();</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="keywordflow">if</span> (! isPreempted) {</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        <span class="comment">// Procedure for blocked tokens.</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="keywordflow">while</span> (queueIterator != <a class="code" href="class_facility.html#a4d45a968945045e44ea59be18dff74d1">queue</a>.end()) {</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;            <span class="keywordflow">if</span> (queueIterator-&gt;token-&gt;priority &gt;= token-&gt;priority) { <span class="comment">// Looking for token with priority lower than token to be enqueued.</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                ++queueIterator;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                <span class="comment">// Found proper place to insert token, after tokens of same priority.</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                <a class="code" href="class_facility.html#a4d45a968945045e44ea59be18dff74d1">queue</a>.insert(queueIterator, <a class="code" href="class_facility_queue_element.html">FacilityQueueElement</a>(token, eventType, serviceTime));</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                <span class="keywordflow">break</span>; <span class="comment">// Exit the loop;</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;            }</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        }</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="comment">// Test whether end of queue was reached; if true, just insert at the end of queue.</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <span class="keywordflow">if</span> (queueIterator == <a class="code" href="class_facility.html#a4d45a968945045e44ea59be18dff74d1">queue</a>.end()) {</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;            <a class="code" href="class_facility.html#a4d45a968945045e44ea59be18dff74d1">queue</a>.push_back(<a class="code" href="class_facility_queue_element.html">FacilityQueueElement</a>(token, eventType, serviceTime));</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        }</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        <span class="comment">// Procedure for preempted tokens.</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        <span class="keywordflow">while</span> (queueIterator != <a class="code" href="class_facility.html#a4d45a968945045e44ea59be18dff74d1">queue</a>.end()) {</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            <span class="keywordflow">if</span> (queueIterator-&gt;token-&gt;priority &lt; token-&gt;priority) { <span class="comment">// Looking for token with priority higher than token to be enqueued.</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                ++queueIterator;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                <span class="comment">// Found proper place to insert token, after tokens of same priority.</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                <a class="code" href="class_facility.html#a4d45a968945045e44ea59be18dff74d1">queue</a>.insert(queueIterator, <a class="code" href="class_facility_queue_element.html">FacilityQueueElement</a>(token, eventType, serviceTime));</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                <span class="keywordflow">break</span>; <span class="comment">// Exit the loop.</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;            }</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        }</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="comment">// Test whether end of queue was reached; if true, just insert at the end of queue.</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <span class="keywordflow">if</span> (queueIterator == <a class="code" href="class_facility.html#a4d45a968945045e44ea59be18dff74d1">queue</a>.end()) {</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;            <a class="code" href="class_facility.html#a4d45a968945045e44ea59be18dff74d1">queue</a>.push_back(<a class="code" href="class_facility_queue_element.html">FacilityQueueElement</a>(token, eventType, serviceTime));</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        }</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    }</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    </div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="comment">//sumLengthTimeProduct += queue.size() * (simulatorGlobals.getCurrentAbsoluteTime() - lastQueueChangeTime);</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="comment">//lastQueueChangeTime = simulatorGlobals.getCurrentAbsoluteTime();</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    </div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="comment">// Update max queue length after queue change.</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="class_facility.html#a4d45a968945045e44ea59be18dff74d1">queue</a>.size() &gt; <a class="code" href="class_facility.html#aab753210fbc2026ce45e73ec3c86ed75">maxRecordedQueueSize</a>) {</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        <a class="code" href="class_facility.html#aab753210fbc2026ce45e73ec3c86ed75">maxRecordedQueueSize</a> = <a class="code" href="class_facility.html#a4d45a968945045e44ea59be18dff74d1">queue</a>.size();</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    }</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;}</div>
<div class="ttc" id="class_facility_html_aab753210fbc2026ce45e73ec3c86ed75"><div class="ttname"><a href="class_facility.html#aab753210fbc2026ce45e73ec3c86ed75">Facility::maxRecordedQueueSize</a></div><div class="ttdeci">unsigned int maxRecordedQueueSize</div><div class="ttdoc">Maximum recorded queue size up to this moment. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00051">Facility.h:51</a></div></div>
<div class="ttc" id="class_facility_html_a4d45a968945045e44ea59be18dff74d1"><div class="ttname"><a href="class_facility.html#a4d45a968945045e44ea59be18dff74d1">Facility::queue</a></div><div class="ttdeci">std::list&lt; FacilityQueueElement &gt; queue</div><div class="ttdoc">Priority queue of tokens in this facility. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00060">Facility.h:60</a></div></div>
<div class="ttc" id="class_facility_html_a04cb8b8f3d633cfcf6ba1603f5dfe7ad"><div class="ttname"><a href="class_facility.html#a04cb8b8f3d633cfcf6ba1603f5dfe7ad">Facility::simulatorGlobals</a></div><div class="ttdeci">SimulatorGlobals &amp; simulatorGlobals</div><div class="ttdoc">Reference to SimulatorGlobals object (typically used to fetch the current clock time). </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00065">Facility.h:65</a></div></div>
<div class="ttc" id="class_simulator_globals_html_a08da82e86d7c26d8f2498bd313f0e66e"><div class="ttname"><a href="class_simulator_globals.html#a08da82e86d7c26d8f2498bd313f0e66e">SimulatorGlobals::getCurrentAbsoluteTime</a></div><div class="ttdeci">double getCurrentAbsoluteTime() const </div><div class="ttdef"><b>Definition:</b> <a href="_simulator_globals_8cpp_source.html#l00070">SimulatorGlobals.cpp:70</a></div></div>
<div class="ttc" id="class_facility_html_a2ecb5a0b0cc18479325d6c3a963972a2"><div class="ttname"><a href="class_facility.html#a2ecb5a0b0cc18479325d6c3a963972a2">Facility::lastQueueChangeTime</a></div><div class="ttdeci">double lastQueueChangeTime</div><div class="ttdoc">Absolute time of last queue change. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00054">Facility.h:54</a></div></div>
<div class="ttc" id="class_facility_html_a6ef416b0d1a9ce5b719dc6499b16fa4b"><div class="ttname"><a href="class_facility.html#a6ef416b0d1a9ce5b719dc6499b16fa4b">Facility::sumLengthTimeProduct</a></div><div class="ttdeci">double sumLengthTimeProduct</div><div class="ttdoc">+= Current queue size * (currentAbsoluteTime - absolute time of last queue change); used to obtain av...</div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00057">Facility.h:57</a></div></div>
<div class="ttc" id="class_facility_queue_element_html"><div class="ttname"><a href="class_facility_queue_element.html">FacilityQueueElement</a></div><div class="ttdoc">Facility Queue Element class. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_queue_element_8h_source.html#l00036">FacilityQueueElement.h:36</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af10ab3d08fb7342ee20f3002a8531717"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int Facility::getDequeuedTokensCount </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get number of dequeues (elements removed from the queue for processing) from this facility's queue.</p>
<dl class="section return"><dt>Returns</dt><dd>Number of dequeues. </dd></dl>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00823">823</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                                                    {</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_facility.html#ad175b4a1db5abafd76e28c67d81b99a4">dequeuedTokensCount</a>;</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;}</div>
<div class="ttc" id="class_facility_html_ad175b4a1db5abafd76e28c67d81b99a4"><div class="ttname"><a href="class_facility.html#ad175b4a1db5abafd76e28c67d81b99a4">Facility::dequeuedTokensCount</a></div><div class="ttdeci">unsigned int dequeuedTokensCount</div><div class="ttdoc">Count of dequeues up to this moment. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00053">Facility.h:53</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac1724d4f29211f7008a14c767f9dc359"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int Facility::getDroppedTokensCount </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get count of dropped or discarded tokens in this facility.</p>
<p>A token will typically be discarded when the token arrives for service and the facility is currently down.</p>
<dl class="section return"><dt>Returns</dt><dd>Count of dropped or discarded tokens. </dd></dl>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00909">909</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;                                                   {</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_facility.html#ab527ba2778f17a4068266fd8b522ec35">droppedTokensCount</a>;</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;}</div>
<div class="ttc" id="class_facility_html_ab527ba2778f17a4068266fd8b522ec35"><div class="ttname"><a href="class_facility.html#ab527ba2778f17a4068266fd8b522ec35">Facility::droppedTokensCount</a></div><div class="ttdeci">unsigned int droppedTokensCount</div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00062">Facility.h:62</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8d3183f02ce17ba8bd1544056a4ba3a9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int Facility::getFullyServicedTokensCount </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get count of fully serviced tokens (no including preemptions) from all servers in this facility.</p>
<p>The number of releases also counts each preemtion as a release (from the preempt function). A token preempted once, and then fully serviced (and released) will count as two releases and one preemption. Obviously, if there are not preemptions, then releasedTokensCount = fully serviced tokens count.</p>
<dl class="section return"><dt>Returns</dt><dd>Count of fully serviced tokens. </dd></dl>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00897">897</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;                                                         {</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_facility.html#a380f50651e6227b6f54ad20a020dba82">releasedTokensCount</a> - <a class="code" href="class_facility.html#ab1535255c93b31fe4cf63ecfcd48fc52">preemptedTokensCount</a>;</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;}</div>
<div class="ttc" id="class_facility_html_ab1535255c93b31fe4cf63ecfcd48fc52"><div class="ttname"><a href="class_facility.html#ab1535255c93b31fe4cf63ecfcd48fc52">Facility::preemptedTokensCount</a></div><div class="ttdeci">unsigned int preemptedTokensCount</div><div class="ttdoc">Count of effective preemptions. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00056">Facility.h:56</a></div></div>
<div class="ttc" id="class_facility_html_a380f50651e6227b6f54ad20a020dba82"><div class="ttname"><a href="class_facility.html#a380f50651e6227b6f54ad20a020dba82">Facility::releasedTokensCount</a></div><div class="ttdeci">unsigned int releasedTokensCount</div><div class="ttdoc">Count of processes which were served (released) by facility. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00058">Facility.h:58</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a67cc29408dd53a988dcd7e2db7b7a4e8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double Facility::getLastQueueChangeTime </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get last absolute time a change in queue (dequeue or enqueue) has happened for this facility.</p>
<p>Will be used to obtain average queue size.</p>
<dl class="section return"><dt>Returns</dt><dd>Absolute time of last queue change. </dd></dl>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00835">835</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;                                              {</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_facility.html#a2ecb5a0b0cc18479325d6c3a963972a2">lastQueueChangeTime</a>;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;}</div>
<div class="ttc" id="class_facility_html_a2ecb5a0b0cc18479325d6c3a963972a2"><div class="ttname"><a href="class_facility.html#a2ecb5a0b0cc18479325d6c3a963972a2">Facility::lastQueueChangeTime</a></div><div class="ttdeci">double lastQueueChangeTime</div><div class="ttdoc">Absolute time of last queue change. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00054">Facility.h:54</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a6ed30291bca3882e011216265f7d7462"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int Facility::getMaxRecordedQueueSize </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get current maximum recorded queue size from this facility.</p>
<dl class="section return"><dt>Returns</dt><dd>Maximum recorded queue size. </dd></dl>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00814">814</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;                                                     {</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_facility.html#aab753210fbc2026ce45e73ec3c86ed75">maxRecordedQueueSize</a>;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;}</div>
<div class="ttc" id="class_facility_html_aab753210fbc2026ce45e73ec3c86ed75"><div class="ttname"><a href="class_facility.html#aab753210fbc2026ce45e73ec3c86ed75">Facility::maxRecordedQueueSize</a></div><div class="ttdeci">unsigned int maxRecordedQueueSize</div><div class="ttdoc">Maximum recorded queue size up to this moment. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00051">Facility.h:51</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="acdb1662a8f2f36e360649a8f760ee096"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double Facility::getMeanBusyPeriod </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>See Jain, MacDougall. </p>
<p>Return mean busy period of facility, all released tokens (including preemptions).</p>
<p>See Jain, MacDougall. This function counts all releases, including preemtions, in the calculation. As such, a token preempted once will count as two releases. This is the MacDougall approach. For counting preempted, fully serviced tokens, use the polymorphic getMeanBusyPeriod(bool onlyFullyServiced) instead.</p>
<dl class="section return"><dt>Returns</dt><dd>Mean busy period. </dd></dl>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00749">749</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                                         {</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    <span class="comment">// If there is no released token yet, then just return the current busy time.</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <span class="keywordflow">return</span> (<a class="code" href="class_facility.html#a380f50651e6227b6f54ad20a020dba82">releasedTokensCount</a> &gt; 0) ? <a class="code" href="class_facility.html#ad85ff7fec4ac7166046cd65a80575def">sumBusyTime</a> / <a class="code" href="class_facility.html#a380f50651e6227b6f54ad20a020dba82">releasedTokensCount</a> : <a class="code" href="class_facility.html#ad85ff7fec4ac7166046cd65a80575def">sumBusyTime</a>;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;}</div>
<div class="ttc" id="class_facility_html_a380f50651e6227b6f54ad20a020dba82"><div class="ttname"><a href="class_facility.html#a380f50651e6227b6f54ad20a020dba82">Facility::releasedTokensCount</a></div><div class="ttdeci">unsigned int releasedTokensCount</div><div class="ttdoc">Count of processes which were served (released) by facility. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00058">Facility.h:58</a></div></div>
<div class="ttc" id="class_facility_html_ad85ff7fec4ac7166046cd65a80575def"><div class="ttname"><a href="class_facility.html#ad85ff7fec4ac7166046cd65a80575def">Facility::sumBusyTime</a></div><div class="ttdeci">double sumBusyTime</div><div class="ttdoc">Total (relative, elapsed) time this facility was busy. Sum (integral) of busy time of all this facili...</div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00055">Facility.h:55</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="abcd560ec9ba0694803e3ab23100ecbaa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double Facility::getMeanBusyPeriod </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>onlyFullyServiced</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>See Jain, MacDougall. </p>
<p>Return mean busy period of facility (not including preemptions, only fully serviced tokens).</p>
<p>See Jain.</p>
<dl class="section return"><dt>Returns</dt><dd>Mean busy period. </dd></dl>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00762">762</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;                                                               {</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    <span class="comment">// If there is no released token yet, then just return the current busy time.</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    <span class="keywordflow">return</span> (<a class="code" href="class_facility.html#a8d3183f02ce17ba8bd1544056a4ba3a9">getFullyServicedTokensCount</a>() &gt; 0) ? <a class="code" href="class_facility.html#ad85ff7fec4ac7166046cd65a80575def">sumBusyTime</a> / <a class="code" href="class_facility.html#a8d3183f02ce17ba8bd1544056a4ba3a9">getFullyServicedTokensCount</a>() : <a class="code" href="class_facility.html#ad85ff7fec4ac7166046cd65a80575def">sumBusyTime</a>;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;}</div>
<div class="ttc" id="class_facility_html_a8d3183f02ce17ba8bd1544056a4ba3a9"><div class="ttname"><a href="class_facility.html#a8d3183f02ce17ba8bd1544056a4ba3a9">Facility::getFullyServicedTokensCount</a></div><div class="ttdeci">unsigned int getFullyServicedTokensCount() const </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8cpp_source.html#l00897">Facility.cpp:897</a></div></div>
<div class="ttc" id="class_facility_html_ad85ff7fec4ac7166046cd65a80575def"><div class="ttname"><a href="class_facility.html#ad85ff7fec4ac7166046cd65a80575def">Facility::sumBusyTime</a></div><div class="ttdeci">double sumBusyTime</div><div class="ttdoc">Total (relative, elapsed) time this facility was busy. Sum (integral) of busy time of all this facili...</div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00055">Facility.h:55</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9fd474a9e15db535a7a05f5f1a44aba1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double Facility::getMeanQueueLength </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>See Jain, MacDougall. </p>
<p>Return mean queue length.</p>
<p>See Jain, MacDougall.</p>
<dl class="section return"><dt>Returns</dt><dd>Mean queue length. </dd></dl>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00775">775</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;                                          {</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    <span class="keywordtype">double</span> duration = <a class="code" href="class_facility.html#a04cb8b8f3d633cfcf6ba1603f5dfe7ad">simulatorGlobals</a>.<a class="code" href="class_simulator_globals.html#aa57fa0ff9b9d44d9c3da2affb9c106e7">getSimulationDuration</a>();</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="comment">// If duration equals zero, then the mean queue length is obviously zero.</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <span class="keywordflow">return</span> (duration &gt; 0.0) ? <a class="code" href="class_facility.html#a6ef416b0d1a9ce5b719dc6499b16fa4b">sumLengthTimeProduct</a> / duration : 0.0;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;}</div>
<div class="ttc" id="class_simulator_globals_html_aa57fa0ff9b9d44d9c3da2affb9c106e7"><div class="ttname"><a href="class_simulator_globals.html#aa57fa0ff9b9d44d9c3da2affb9c106e7">SimulatorGlobals::getSimulationDuration</a></div><div class="ttdeci">double getSimulationDuration() const </div><div class="ttdef"><b>Definition:</b> <a href="_simulator_globals_8cpp_source.html#l00096">SimulatorGlobals.cpp:96</a></div></div>
<div class="ttc" id="class_facility_html_a04cb8b8f3d633cfcf6ba1603f5dfe7ad"><div class="ttname"><a href="class_facility.html#a04cb8b8f3d633cfcf6ba1603f5dfe7ad">Facility::simulatorGlobals</a></div><div class="ttdeci">SimulatorGlobals &amp; simulatorGlobals</div><div class="ttdoc">Reference to SimulatorGlobals object (typically used to fetch the current clock time). </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00065">Facility.h:65</a></div></div>
<div class="ttc" id="class_facility_html_a6ef416b0d1a9ce5b719dc6499b16fa4b"><div class="ttname"><a href="class_facility.html#a6ef416b0d1a9ce5b719dc6499b16fa4b">Facility::sumLengthTimeProduct</a></div><div class="ttdeci">double sumLengthTimeProduct</div><div class="ttdoc">+= Current queue size * (currentAbsoluteTime - absolute time of last queue change); used to obtain av...</div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00057">Facility.h:57</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5b1017640e4313c95af773cf9d6606dd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double Facility::getMeanServiceRate </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns Mean Service Rate.</p>
<dl class="section return"><dt>Returns</dt><dd>Mean service rate. </dd></dl>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00692">692</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                                          {</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_facility.html#a8d3183f02ce17ba8bd1544056a4ba3a9">getFullyServicedTokensCount</a>() / (<a class="code" href="class_facility.html#a04cb8b8f3d633cfcf6ba1603f5dfe7ad">simulatorGlobals</a>.<a class="code" href="class_simulator_globals.html#a08da82e86d7c26d8f2498bd313f0e66e">getCurrentAbsoluteTime</a>() * <a class="code" href="class_facility.html#a4774c30a592bb2633877067028dc1717">getUtilization</a>());</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;}</div>
<div class="ttc" id="class_facility_html_a4774c30a592bb2633877067028dc1717"><div class="ttname"><a href="class_facility.html#a4774c30a592bb2633877067028dc1717">Facility::getUtilization</a></div><div class="ttdeci">double getUtilization() const </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8cpp_source.html#l00732">Facility.cpp:732</a></div></div>
<div class="ttc" id="class_facility_html_a04cb8b8f3d633cfcf6ba1603f5dfe7ad"><div class="ttname"><a href="class_facility.html#a04cb8b8f3d633cfcf6ba1603f5dfe7ad">Facility::simulatorGlobals</a></div><div class="ttdeci">SimulatorGlobals &amp; simulatorGlobals</div><div class="ttdoc">Reference to SimulatorGlobals object (typically used to fetch the current clock time). </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00065">Facility.h:65</a></div></div>
<div class="ttc" id="class_simulator_globals_html_a08da82e86d7c26d8f2498bd313f0e66e"><div class="ttname"><a href="class_simulator_globals.html#a08da82e86d7c26d8f2498bd313f0e66e">SimulatorGlobals::getCurrentAbsoluteTime</a></div><div class="ttdeci">double getCurrentAbsoluteTime() const </div><div class="ttdef"><b>Definition:</b> <a href="_simulator_globals_8cpp_source.html#l00070">SimulatorGlobals.cpp:70</a></div></div>
<div class="ttc" id="class_facility_html_a8d3183f02ce17ba8bd1544056a4ba3a9"><div class="ttname"><a href="class_facility.html#a8d3183f02ce17ba8bd1544056a4ba3a9">Facility::getFullyServicedTokensCount</a></div><div class="ttdeci">unsigned int getFullyServicedTokensCount() const </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8cpp_source.html#l00897">Facility.cpp:897</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad78afc03b5985c349e8a25bb3608c232"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::string Facility::getName </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get facility's name.</p>
<dl class="section return"><dt>Returns</dt><dd>Name. </dd></dl>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00786">786</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;                                  {</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_facility.html#a5967500c415fbf6b3bf420b58e645a6e">name</a>;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;}</div>
<div class="ttc" id="class_facility_html_a5967500c415fbf6b3bf420b58e645a6e"><div class="ttname"><a href="class_facility.html#a5967500c415fbf6b3bf420b58e645a6e">Facility::name</a></div><div class="ttdeci">std::string name</div><div class="ttdoc">Facility name. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00046">Facility.h:46</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af8a7f4d06884853b43de507d5dbad7a2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int Facility::getNumberOfServers </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get number of servers in this facility.</p>
<p>Basically counts the size of servers vector.</p>
<dl class="section return"><dt>Returns</dt><dd>Number of servers. </dd></dl>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00805">805</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;                                                {</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_facility.html#a0519eef6d28a92c9b7a7d6a3bc9db31a">servers</a>.size();</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;}</div>
<div class="ttc" id="class_facility_html_a0519eef6d28a92c9b7a7d6a3bc9db31a"><div class="ttname"><a href="class_facility.html#a0519eef6d28a92c9b7a7d6a3bc9db31a">Facility::servers</a></div><div class="ttdeci">std::vector&lt; FacilityServer &gt; servers</div><div class="ttdoc">List of servers in this facility. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00059">Facility.h:59</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a69b6c90815494efdffd9a643b092800e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int Facility::getPreemptedTokensCount </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get count of preemptions occurred so far in this facility.</p>
<p>Sum of preemptions of all servers in this facility.</p>
<dl class="section return"><dt>Returns</dt><dd>Count of preemptions. </dd></dl>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00859">859</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;                                                     {</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_facility.html#ab1535255c93b31fe4cf63ecfcd48fc52">preemptedTokensCount</a>;</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;}</div>
<div class="ttc" id="class_facility_html_ab1535255c93b31fe4cf63ecfcd48fc52"><div class="ttname"><a href="class_facility.html#ab1535255c93b31fe4cf63ecfcd48fc52">Facility::preemptedTokensCount</a></div><div class="ttdeci">unsigned int preemptedTokensCount</div><div class="ttdoc">Count of effective preemptions. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00056">Facility.h:56</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a61f5bb8a3af86066d29dd2eeca3cdd84"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::list&lt; <a class="el" href="class_facility_queue_element.html">FacilityQueueElement</a> &gt;::size_type Facility::getQueueSize </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return current queue size.</p>
<dl class="section return"><dt>Returns</dt><dd>Queue size. </dd></dl>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00723">723</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                                                                    {</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_facility.html#a4d45a968945045e44ea59be18dff74d1">queue</a>.size();</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;}</div>
<div class="ttc" id="class_facility_html_a4d45a968945045e44ea59be18dff74d1"><div class="ttname"><a href="class_facility.html#a4d45a968945045e44ea59be18dff74d1">Facility::queue</a></div><div class="ttdeci">std::list&lt; FacilityQueueElement &gt; queue</div><div class="ttdoc">Priority queue of tokens in this facility. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00060">Facility.h:60</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ababbaa909332f3c55699721dc087f0c3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int Facility::getQueueSizeLimit </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get current queue size limit.</p>
<p>When the queue reaches the limit, all subsequent service requests (tokens) will be dropped until the queue size decreases below the limit. Verify behavior for preemption under preempt function description. Default value is std::numeric_limits&lt;unsigned int&gt;::max().</p>
<dl class="section return"><dt>Returns</dt><dd>Current queue size limit. </dd></dl>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00952">952</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;                                               {</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_facility.html#a1c5d07b106f295750da83ef6d31f7c34">queueSizeLimit</a>;</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;}</div>
<div class="ttc" id="class_facility_html_a1c5d07b106f295750da83ef6d31f7c34"><div class="ttname"><a href="class_facility.html#a1c5d07b106f295750da83ef6d31f7c34">Facility::queueSizeLimit</a></div><div class="ttdeci">unsigned int queueSizeLimit</div><div class="ttdoc">The maximum size the queue can reach (default is std::numeric_limits&amp;lt;unsigned int&amp;gt;::max()); if reache...</div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00052">Facility.h:52</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a566a2efd483b20277d964b649d82acf8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int Facility::getReleasedTokensCount </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get count of releases from all servers in this facility.</p>
<p>The number of releases also counts each preemtion as a release (from the preempt function).</p>
<dl class="section return"><dt>Returns</dt><dd>Count of releases. </dd></dl>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00883">883</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;                                                    {</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_facility.html#a380f50651e6227b6f54ad20a020dba82">releasedTokensCount</a>;</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;}</div>
<div class="ttc" id="class_facility_html_a380f50651e6227b6f54ad20a020dba82"><div class="ttname"><a href="class_facility.html#a380f50651e6227b6f54ad20a020dba82">Facility::releasedTokensCount</a></div><div class="ttdeci">unsigned int releasedTokensCount</div><div class="ttdoc">Count of processes which were served (released) by facility. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00058">Facility.h:58</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a36e512ba8667b6a2f62b131c3afca926"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int Facility::getRequestsPreemptsCount </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get count of service requests and preemptions made to this facility.</p>
<p>Notice that a token might have more than one request, e.g., if the first request finds a busy facility, token is enqueued. Dequeuing will generated another service request. Therefore, for this single token, two requests would be generated and counted. This statistic is <em>not</em>, therefore, the same as number of unique arrivals at the facility's queue. To obtain this count of unique arrivals, perhaps it is best to count the number of tokens generated for this facility from specific traffic source. Obviously this statistic can be calculated from others, but it is good to have it independent for debugging purposes.</p>
<dl class="section return"><dt>Returns</dt><dd>Count of service requests and preemptions made to this facility. </dd></dl>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00924">924</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;                                                      {</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_facility.html#ae813c0db5554a9827600e10cfc863748">requestsPreemptsCount</a>;</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;}</div>
<div class="ttc" id="class_facility_html_ae813c0db5554a9827600e10cfc863748"><div class="ttname"><a href="class_facility.html#ae813c0db5554a9827600e10cfc863748">Facility::requestsPreemptsCount</a></div><div class="ttdeci">unsigned int requestsPreemptsCount</div><div class="ttdoc">Count of number of service requests and preemptions made to this facility (regardless of the outcome)...</div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00067">Facility.h:67</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9d7afc7dca414dc23dd1ef324396c510"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double Facility::getSumBusyTime </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get total (relative, elapsed) time this facility was busy.</p>
<p>Sum (integral) of busy time of all this facility's servers.</p>
<dl class="section return"><dt>Returns</dt><dd>Relative, elapsed time this facility was busy. </dd></dl>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00847">847</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;                                      {</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_facility.html#ad85ff7fec4ac7166046cd65a80575def">sumBusyTime</a>;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;}</div>
<div class="ttc" id="class_facility_html_ad85ff7fec4ac7166046cd65a80575def"><div class="ttname"><a href="class_facility.html#ad85ff7fec4ac7166046cd65a80575def">Facility::sumBusyTime</a></div><div class="ttdeci">double sumBusyTime</div><div class="ttdoc">Total (relative, elapsed) time this facility was busy. Sum (integral) of busy time of all this facili...</div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00055">Facility.h:55</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af893b9858d117fa8da34450b5c690d67"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double Facility::getSumLengthTimeProduct </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get sumLengthTimeProduct for this facility.</p>
<p>+= Current queue size * (currentAbsoluteTime - absolute time of last queue change); used to obtain average queue size.</p>
<dl class="section return"><dt>Returns</dt><dd>Sum of queue length multiplied by time delta in queue. </dd></dl>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00871">871</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;                                               {</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_facility.html#a6ef416b0d1a9ce5b719dc6499b16fa4b">sumLengthTimeProduct</a>;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;}</div>
<div class="ttc" id="class_facility_html_a6ef416b0d1a9ce5b719dc6499b16fa4b"><div class="ttname"><a href="class_facility.html#a6ef416b0d1a9ce5b719dc6499b16fa4b">Facility::sumLengthTimeProduct</a></div><div class="ttdeci">double sumLengthTimeProduct</div><div class="ttdoc">+= Current queue size * (currentAbsoluteTime - absolute time of last queue change); used to obtain av...</div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00057">Facility.h:57</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4774c30a592bb2633877067028dc1717"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double Facility::getUtilization </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return facility utilization.</p>
<dl class="section return"><dt>Returns</dt><dd>Utilization. </dd></dl>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00732">732</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;                                      {</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    <span class="comment">// Get the duration of the simulation up to this moment.</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="keywordtype">double</span> duration = <a class="code" href="class_facility.html#a04cb8b8f3d633cfcf6ba1603f5dfe7ad">simulatorGlobals</a>.<a class="code" href="class_simulator_globals.html#aa57fa0ff9b9d44d9c3da2affb9c106e7">getSimulationDuration</a>();</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    <span class="comment">// If the duration of the simulation is zero, then utilization is zero (avoid /0 here).</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <span class="keywordflow">return</span> (duration &gt; 0.0) ? <a class="code" href="class_facility.html#ad85ff7fec4ac7166046cd65a80575def">sumBusyTime</a> / duration : 0.0;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;}</div>
<div class="ttc" id="class_simulator_globals_html_aa57fa0ff9b9d44d9c3da2affb9c106e7"><div class="ttname"><a href="class_simulator_globals.html#aa57fa0ff9b9d44d9c3da2affb9c106e7">SimulatorGlobals::getSimulationDuration</a></div><div class="ttdeci">double getSimulationDuration() const </div><div class="ttdef"><b>Definition:</b> <a href="_simulator_globals_8cpp_source.html#l00096">SimulatorGlobals.cpp:96</a></div></div>
<div class="ttc" id="class_facility_html_a04cb8b8f3d633cfcf6ba1603f5dfe7ad"><div class="ttname"><a href="class_facility.html#a04cb8b8f3d633cfcf6ba1603f5dfe7ad">Facility::simulatorGlobals</a></div><div class="ttdeci">SimulatorGlobals &amp; simulatorGlobals</div><div class="ttdoc">Reference to SimulatorGlobals object (typically used to fetch the current clock time). </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00065">Facility.h:65</a></div></div>
<div class="ttc" id="class_facility_html_ad85ff7fec4ac7166046cd65a80575def"><div class="ttname"><a href="class_facility.html#ad85ff7fec4ac7166046cd65a80575def">Facility::sumBusyTime</a></div><div class="ttdeci">double sumBusyTime</div><div class="ttdoc">Total (relative, elapsed) time this facility was busy. Sum (integral) of busy time of all this facili...</div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00055">Facility.h:55</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a31e9fbb87215bd9b292aa263150010d6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Facility::initializeMembers </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Initialize all facilities' member variables. </p>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00055">55</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;                                 {</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <a class="code" href="class_facility.html#aab753210fbc2026ce45e73ec3c86ed75">maxRecordedQueueSize</a> = 0;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <a class="code" href="class_facility.html#ad175b4a1db5abafd76e28c67d81b99a4">dequeuedTokensCount</a> = 0;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <a class="code" href="class_facility.html#a2ecb5a0b0cc18479325d6c3a963972a2">lastQueueChangeTime</a> = 0.0;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <a class="code" href="class_facility.html#ad85ff7fec4ac7166046cd65a80575def">sumBusyTime</a> = 0.0;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <a class="code" href="class_facility.html#ab1535255c93b31fe4cf63ecfcd48fc52">preemptedTokensCount</a> = 0;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <a class="code" href="class_facility.html#a6ef416b0d1a9ce5b719dc6499b16fa4b">sumLengthTimeProduct</a> = 0.0;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <a class="code" href="class_facility.html#a380f50651e6227b6f54ad20a020dba82">releasedTokensCount</a> = 0;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <a class="code" href="class_facility.html#a79363e2f35ebed14de6cf7b34bb96ecf">isUp_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <a class="code" href="class_facility.html#ab527ba2778f17a4068266fd8b522ec35">droppedTokensCount</a> = 0;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <a class="code" href="class_facility.html#ae813c0db5554a9827600e10cfc863748">requestsPreemptsCount</a> = 0;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <a class="code" href="class_facility.html#a1c5d07b106f295750da83ef6d31f7c34">queueSizeLimit</a> = std::numeric_limits&lt;unsigned int&gt;::max();</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;}</div>
<div class="ttc" id="class_facility_html_ab1535255c93b31fe4cf63ecfcd48fc52"><div class="ttname"><a href="class_facility.html#ab1535255c93b31fe4cf63ecfcd48fc52">Facility::preemptedTokensCount</a></div><div class="ttdeci">unsigned int preemptedTokensCount</div><div class="ttdoc">Count of effective preemptions. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00056">Facility.h:56</a></div></div>
<div class="ttc" id="class_facility_html_aab753210fbc2026ce45e73ec3c86ed75"><div class="ttname"><a href="class_facility.html#aab753210fbc2026ce45e73ec3c86ed75">Facility::maxRecordedQueueSize</a></div><div class="ttdeci">unsigned int maxRecordedQueueSize</div><div class="ttdoc">Maximum recorded queue size up to this moment. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00051">Facility.h:51</a></div></div>
<div class="ttc" id="class_facility_html_ab527ba2778f17a4068266fd8b522ec35"><div class="ttname"><a href="class_facility.html#ab527ba2778f17a4068266fd8b522ec35">Facility::droppedTokensCount</a></div><div class="ttdeci">unsigned int droppedTokensCount</div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00062">Facility.h:62</a></div></div>
<div class="ttc" id="class_facility_html_ae813c0db5554a9827600e10cfc863748"><div class="ttname"><a href="class_facility.html#ae813c0db5554a9827600e10cfc863748">Facility::requestsPreemptsCount</a></div><div class="ttdeci">unsigned int requestsPreemptsCount</div><div class="ttdoc">Count of number of service requests and preemptions made to this facility (regardless of the outcome)...</div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00067">Facility.h:67</a></div></div>
<div class="ttc" id="class_facility_html_ad175b4a1db5abafd76e28c67d81b99a4"><div class="ttname"><a href="class_facility.html#ad175b4a1db5abafd76e28c67d81b99a4">Facility::dequeuedTokensCount</a></div><div class="ttdeci">unsigned int dequeuedTokensCount</div><div class="ttdoc">Count of dequeues up to this moment. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00053">Facility.h:53</a></div></div>
<div class="ttc" id="class_facility_html_a1c5d07b106f295750da83ef6d31f7c34"><div class="ttname"><a href="class_facility.html#a1c5d07b106f295750da83ef6d31f7c34">Facility::queueSizeLimit</a></div><div class="ttdeci">unsigned int queueSizeLimit</div><div class="ttdoc">The maximum size the queue can reach (default is std::numeric_limits&amp;lt;unsigned int&amp;gt;::max()); if reache...</div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00052">Facility.h:52</a></div></div>
<div class="ttc" id="class_facility_html_a2ecb5a0b0cc18479325d6c3a963972a2"><div class="ttname"><a href="class_facility.html#a2ecb5a0b0cc18479325d6c3a963972a2">Facility::lastQueueChangeTime</a></div><div class="ttdeci">double lastQueueChangeTime</div><div class="ttdoc">Absolute time of last queue change. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00054">Facility.h:54</a></div></div>
<div class="ttc" id="class_facility_html_a6ef416b0d1a9ce5b719dc6499b16fa4b"><div class="ttname"><a href="class_facility.html#a6ef416b0d1a9ce5b719dc6499b16fa4b">Facility::sumLengthTimeProduct</a></div><div class="ttdeci">double sumLengthTimeProduct</div><div class="ttdoc">+= Current queue size * (currentAbsoluteTime - absolute time of last queue change); used to obtain av...</div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00057">Facility.h:57</a></div></div>
<div class="ttc" id="class_facility_html_a79363e2f35ebed14de6cf7b34bb96ecf"><div class="ttname"><a href="class_facility.html#a79363e2f35ebed14de6cf7b34bb96ecf">Facility::isUp_</a></div><div class="ttdeci">bool isUp_</div><div class="ttdoc">Status of facility: true for up (operational), false for down (non-operational). </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00061">Facility.h:61</a></div></div>
<div class="ttc" id="class_facility_html_a380f50651e6227b6f54ad20a020dba82"><div class="ttname"><a href="class_facility.html#a380f50651e6227b6f54ad20a020dba82">Facility::releasedTokensCount</a></div><div class="ttdeci">unsigned int releasedTokensCount</div><div class="ttdoc">Count of processes which were served (released) by facility. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00058">Facility.h:58</a></div></div>
<div class="ttc" id="class_facility_html_ad85ff7fec4ac7166046cd65a80575def"><div class="ttname"><a href="class_facility.html#ad85ff7fec4ac7166046cd65a80575def">Facility::sumBusyTime</a></div><div class="ttdeci">double sumBusyTime</div><div class="ttdoc">Total (relative, elapsed) time this facility was busy. Sum (integral) of busy time of all this facili...</div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00055">Facility.h:55</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a51a7f1911c56425bd1f341b3c2b005e0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool Facility::isBusy </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns the busy status of this facility.</p>
<p>The busy status has no relation to the up/down status. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000008">Todo:</a></b></dt><dd><p class="startdd">Should it? </p>
<p class="enddd">Perhaps should analyze the performance cost of this function, and use a bool isBusy member variable? The number of servers in the facility is really not dynamic...</p>
</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>True if busy, false if non-busy (not necessarily available, however; facility might be down). </dd></dl>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00626">626</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                            {</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    <span class="comment">// If all servers in vector are busy, then facility is busy.</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <span class="comment">// If the iterator returned by nextFreeServer() does not point to servers.end(), then a free server was found.</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="class_facility.html#af7ceb3abf7be8d3712d9bb8f9841067c">nextFreeServer</a>() != <a class="code" href="class_facility.html#a0519eef6d28a92c9b7a7d6a3bc9db31a">servers</a>.end()) {</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    }</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// If reached this line, then no free server was found (servers.end() was returned by nextFreeServer()).</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;}</div>
<div class="ttc" id="class_facility_html_af7ceb3abf7be8d3712d9bb8f9841067c"><div class="ttname"><a href="class_facility.html#af7ceb3abf7be8d3712d9bb8f9841067c">Facility::nextFreeServer</a></div><div class="ttdeci">std::vector&lt; FacilityServer &gt;::iterator nextFreeServer()</div><div class="ttdef"><b>Definition:</b> <a href="_facility_8cpp_source.html#l00648">Facility.cpp:648</a></div></div>
<div class="ttc" id="class_facility_html_a0519eef6d28a92c9b7a7d6a3bc9db31a"><div class="ttname"><a href="class_facility.html#a0519eef6d28a92c9b7a7d6a3bc9db31a">Facility::servers</a></div><div class="ttdeci">std::vector&lt; FacilityServer &gt; servers</div><div class="ttdoc">List of servers in this facility. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00059">Facility.h:59</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a648c145304ac37af293458ea11f674c3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool Facility::isUp </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns up/down status of facility.</p>
<p>Up/down status has no relation to busy status.</p>
<dl class="section return"><dt>Returns</dt><dd>True if up, false if down. </dd></dl>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00683">683</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;                          {</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_facility.html#a79363e2f35ebed14de6cf7b34bb96ecf">isUp_</a>;</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;}</div>
<div class="ttc" id="class_facility_html_a79363e2f35ebed14de6cf7b34bb96ecf"><div class="ttname"><a href="class_facility.html#a79363e2f35ebed14de6cf7b34bb96ecf">Facility::isUp_</a></div><div class="ttdeci">bool isUp_</div><div class="ttdoc">Status of facility: true for up (operational), false for down (non-operational). </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00061">Facility.h:61</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af7ceb3abf7be8d3712d9bb8f9841067c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; <a class="el" href="class_facility_server.html">FacilityServer</a> &gt;::iterator Facility::nextFreeServer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Returns iterator to a free server within this facility.</p>
<p>The iterator might point servers.end(), indicating that there are no free servers. This must be tested by the calling function.</p>
<dl class="section note"><dt>Note</dt><dd>I found no way of using const_cast&lt;&gt;(static_cast&lt;&gt;()) to cast away constness and re-use the const version of this function here, as described in Effective C++, by Scott Meyers.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>Iterator to a free server, or servers.end(). </dd></dl>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00648">648</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                                                           {</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <span class="keywordflow">for</span> (std::vector&lt;FacilityServer&gt;::iterator serversIterator = <a class="code" href="class_facility.html#a0519eef6d28a92c9b7a7d6a3bc9db31a">servers</a>.begin(); serversIterator != <a class="code" href="class_facility.html#a0519eef6d28a92c9b7a7d6a3bc9db31a">servers</a>.end(); ++serversIterator) {</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        <span class="keywordflow">if</span> (! serversIterator-&gt;isBusy) { <span class="comment">// Return immediately with reference if one server is found free.</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;            <span class="keywordflow">return</span> serversIterator;</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        }</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    }</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_facility.html#a0519eef6d28a92c9b7a7d6a3bc9db31a">servers</a>.end(); <span class="comment">// If reached this line, then no free server was found.</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;}</div>
<div class="ttc" id="class_facility_html_a0519eef6d28a92c9b7a7d6a3bc9db31a"><div class="ttname"><a href="class_facility.html#a0519eef6d28a92c9b7a7d6a3bc9db31a">Facility::servers</a></div><div class="ttdeci">std::vector&lt; FacilityServer &gt; servers</div><div class="ttdoc">List of servers in this facility. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00059">Facility.h:59</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1876f38a8faf1d5d45fcd005abf1da53"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; <a class="el" href="class_facility_server.html">FacilityServer</a> &gt;::const_iterator Facility::nextFreeServer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Returns iterator to a free server within this facility, const version.</p>
<p>The iterator might point servers.end(), indicating that there are no free servers. This must be tested by the calling function.</p>
<dl class="section return"><dt>Returns</dt><dd>Const_iterator to a free server, or servers.end(). </dd></dl>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00666">666</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                                                                       {</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    <span class="keywordflow">for</span> (std::vector&lt;FacilityServer&gt;::const_iterator serversIterator = <a class="code" href="class_facility.html#a0519eef6d28a92c9b7a7d6a3bc9db31a">servers</a>.begin(); serversIterator != <a class="code" href="class_facility.html#a0519eef6d28a92c9b7a7d6a3bc9db31a">servers</a>.end(); ++serversIterator) {</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        <span class="keywordflow">if</span> (! serversIterator-&gt;isBusy) { <span class="comment">// Return immediately with reference if one server is found free.</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;            <span class="keywordflow">return</span> serversIterator;</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        }</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    }</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_facility.html#a0519eef6d28a92c9b7a7d6a3bc9db31a">servers</a>.end(); <span class="comment">// If reached this line, then no free server was found.</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;}</div>
<div class="ttc" id="class_facility_html_a0519eef6d28a92c9b7a7d6a3bc9db31a"><div class="ttname"><a href="class_facility.html#a0519eef6d28a92c9b7a7d6a3bc9db31a">Facility::servers</a></div><div class="ttdeci">std::vector&lt; FacilityServer &gt; servers</div><div class="ttdoc">List of servers in this facility. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00059">Facility.h:59</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3fbc8bb6b4a1f64d7ac2796df89eb05e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_facility_return_type_8h.html#a4ebe26bb7c3ad3b1926de74522fcc72c">FacilityReturnType</a> Facility::preempt </td>
          <td>(</td>
          <td class="paramtype">std::shared_ptr&lt; const <a class="el" href="class_token.html">Token</a> &gt;&#160;</td>
          <td class="paramname"><em>token</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_event_type_8h.html#a2628ea8d12e8b2563c32f05dc7fff6fa">EventType</a>&#160;</td>
          <td class="paramname"><em>eventType</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Preempts a token already in service and attempts to put another token in service at this facility.</p>
<p>Receives a token with the associated priority. Searches the list of servers for either a free server, or a busy server servicing a lower-priority token. First, the function searches for a free server. If none is found, then it begins searching for busy servers servicing lower-priority tokens.</p>
<p>There are three possible cases:</p>
<p>(1) <a class="el" href="class_facility.html" title="Facility class. ">Facility</a> is down: if the facility is down, the token is not put into service, and the dropped tokens counter is updated. Hence, the token is considered dropped (but it is not actually dropped in this function). Returns FACILITY_DOWN_TOKEN_DROPPED.</p>
<p>(2) A free server was found: the token is put into service in this server. Here, the preempt function works exactly as the request function. Returns TOKEN_PUT_INTO_SERVICE.</p>
<p>(3a) No free server was found: if no free server was found, then the list of servers is again searched, now considering the priority of the token passed as argument and the priority of tokens in service. Among all busy servers, the one servicing the token with the lowest priority is selected. If this priority is lower than the priority of the token passed as argument (i.e., the priority of the argument token is strictly less than the priority of the token in the busy server), then this token being serviced is removed from service, and the argument token is put into service in place. The preempted token is enqueued with the remaining service time and also according to its priority, but before tokens with the same priority (such that it is service before those tokens). A release event for the preempted token <em>must</em> be removed from the event chain!! Returns TOKEN_PUT_INTO_SERVICE. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000005">Todo:</a></b></dt><dd><p class="startdd">enqueuing here cannot be made with the enqueue function, since it will enqueue the token <em>after</em> tokens with same priority! </p>
<p class="enddd">Verify behavior here in case there is a queue size limit!! </p>
</dd></dl>
<p>(3b) No free server was found: no free server was found, and, among the busy servers, all tokens in service have priority equal or higher than the argument token. Then, enqueue the token as it is done in the request function. Returns FACILITY_BUSY_TOKEN_ENQUEUED.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">token</td><td><a class="el" href="class_token.html" title="Token class. ">Token</a> object for which service is requested. </td></tr>
    <tr><td class="paramname">eventType</td><td><a class="el" href="class_event.html" title="Event class. ">Event</a> type of the event that requested service for this token (necessary for enqueing the token, and later scheduling a new request for the dequeued token). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Return type or result of this token (whether the token was enqueued, put into service, etc.).</dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000006">Todo:</a></b></dt><dd>To be implemented. </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000007">Todo:</a></b></dt><dd>dummy </dd></dl>
<p>*----&mdash;PREEMPT FACILITY WITH TOKEN POINTER - FC preemptp -------------&mdash; </p>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00294">294</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                                                                                          {</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="comment">// Increment preemptions count.</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    ++<a class="code" href="class_facility.html#ae813c0db5554a9827600e10cfc863748">requestsPreemptsCount</a>;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    </div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_facility_return_type_8h.html#a4ebe26bb7c3ad3b1926de74522fcc72ca3e860a081575fc82cc7b6ed2ca602947">FacilityReturnType::NOT_IMPLEMENTED</a>; </div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="comment">// Comments from Tarvos regarding releasedTokensCount.</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    </div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">/* Note: this function, as it is, is *not* incrementing # of releases upon a successful preemption.</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">*       This is in contrast with SMPL approach. Although the current approach will yield a correct</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">*       Mean of Busy Time calculation, problems might arise if a preempted token never goes back to service.</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">*       If a preempted token never goes back to service, then the service time is has received so far did</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">*       go into Sum of Busy Time, but a # release count will never be accumulated for this token. Therefore,</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">*       the effect is adding time to the Sum of Busy Time for no specific token, causing an &quot;error&quot; in the</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">*       computation of the Mean of Busy Time.</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">*</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">*       (more)</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment">*       This SMPL behavior has effects on the correct calculation of certain statistics,</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">*       namely Sum of Busy Time and Mean Busy Period. Mean Busy Period relies on # of releases to calculate the mean.</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">*       A preempted token moving back into service, and then released, can be technically considered as two tokens:</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">*       one is serviced up to time t and then &quot;released&quot;; the second is serviced for the remaining service time and then</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment">*       released. Sum of Busy Time accumulates both parts of the service (before preemption, and after resuming service), </span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment">*       and Number of Releases accumulates two releases for the same token. The final Mean Busy Period will be slightly different</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">*       than accumulating one whole service time (the sum of the two parts of the service for the preempted token) and dividing by</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">*       *one* single release for the same token.</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">*       The larger the value of Sum of Busy Time and # of Releases, the less the difference, but it exists.</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">*       SMPL treatment also causes problems if # of Releases is used as # of Tokens serviced. A preempted token will be counted twice.</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment">*       A simple fix is to obtain the # of Serviced tokens as # of Releases - # of Preemptions.</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment">*       And, perhaps, use, for calculating the Mean Busy Period, the # of Serviced Tokens, and not # of Releases.</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment">*       (01.August.2013 Marcos Portnoi) </span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    </div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="comment">// This is Tarvos.</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">//* A funcao preempt foi modificada com o acrescimo de um apontador associado</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">//* a tkn para que na area apontada tenha mais informacoes sobre a tkn. Desta</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">//* maneira pode-se acrescentar caracteristicas da token. Neste caso criou-se</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">//* uma variavel tkp - token pointer com o tipo da estrutura do pacote.</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment">//* Este programa trabalha com um sistema de prioridade de processamento da</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">//* token onde o maior valor numerico de prioridade tem tambem a maior prioridade de</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment">//* execucao.</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment">//* Assim, uma token com prioridade 5 devera ser processada antes de tokens com prioridade</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment">//* menor do que cinco.</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">//* Comentrio:  na funo originalmente implementada, caso as tokens em servio tenham</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">//* prioridade igual ou menor que a token que chama a preempo, ento no haver preempo;</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">//* esta funo chama pois a funo enqueuep_preempt, que coloca a token em questo na fila</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">//* da facility em ordem de prioridade, mas  frente de outras tokens de mesma prioridade.</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">//* No seria portanto uma ao idntica  requestp, como prev MacDougall para o SMPL.</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">//* Em havendo de fato a preempo, a token que foi retirada de servio vai para a fila em</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">//* ordem de prioridade, e  frente de outras tokens de mesma prioridade, podendo assim</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">//* voltar a servio imediatamente  frente das outras tokens enfileiradas de mesma prioridade.</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment">//* O funcionamento original, portanto, no est conforme previsto por MacDougall no SMPL.  Se no //* houver preempo e preemptp deve funcionar como um requestp neste caso, ento a token
//* deve ser enfileirada por ordem de prioridade em ao fim das tokens de mesma prioridade
//* (deve obedecer ao esquema FIFO dentre a mesma prioridade).  Uma chamada  funo enqueuep,
//* ao invs de enqueuep_preempt, para o caso de no haver preempo, deve resolver a questo.
//* (08.Jan.2006 Marcos Portnoi)
//*
//* A funo retorna:
//*  0 se a facility tem servidor disponvel e o token foi colocado em servio;
//*  1 se a facility no tem servidor disponvel; token colocada na fila
//*  2 se a facility est down (no-operacional); nada foi feito com a token
//* O contador de tokens descartados tambm  incrementado para o caso 2.
//* (estas ampliaes de estado da facility 10.Jan.2006 Marcos Portnoi)
//*/
//int preemptp (int f, int tkn, int pri, int ev, double te, TOKEN *tkp) {
//  int r, tkn_srv, tkn_pri_srv, ev_srv, menor_pri;
//  struct facilit *fct;
//  struct fserv *srv, *srv_menor_pri;
//  struct evchain *evc_tkn_srv;
//  TOKEN *tkp_srv;
//  double te_srv;
//
//  if ( tkn == 0 )
//  {
//      printf (&quot;\nError - preemptp - token = 0 &quot;);
//      exit (1);
//  }
//
//  if ( f &gt; sim[sn].fct_number)
//  {
//      printf (&quot;\nError - preemptp - facility number does not exist&quot;);
//      exit (1);
//  }
//
//  fct = sim[sn].fct_begin;
//  while (fct-&gt;f_number != f)
//  {
//      fct=fct-&gt;fct_next;
//  }
//
//  //se a facility estiver down, retorne imediatamente com 2
//  //O programa do usurio deve decidir o que fazer com a token (descartar ou no)
//  if (getFacUpStatus(f)==0)
//  {
//      fct-&gt;f_tkn_dropped++; //incremente contador de tokens descartadas; se isso no for interessante para o usurio, ento esta linha deve ser editada
//      return 2;
//  }
//
//  /*Situacoes possveis na preempo:
//     1. Se tiver servidor livre aloca o servidor com a token e retorna 0 da funcao
//   2. Se todos os servidores estiverem ocupados verifica-se as prioridades das tokens em servico
//          a. Se as tokens em servico tiverem prioridade maior ou igual a token que chama a preempo, entao a
//             token que chama a preempo eh colocada em fila como qualquer outra token e 1 eh retornado ou seja
//               o preempt funciona exatamente como o request.
//          b. Se a token em servico tiver prioridade menor que do que a token atual, retira a token
//             de servico fazendo todas as atualizacoes necessarias -
//               . retira da cadeia de eventos o termino do servico desta token (caso ela nao encontre
//                 esta token com termino de servico um erro e retornado
//               . acrescenta a utilizacao na facility e no servidor do tempo que ela passou em servico
//                 este tempo eh o clock atual subtraido do tempo em que ela entrou em servico
//                   pois de toda forma ele ja usou os recursos de servico
//               . coloca entao a token retirada em servico na fila de espera onde o tempo que estara
//                 associado ao termino de servico da token e o tempo final de servico do evento
//                   retirado da cadeia de eventos diminuido do clock atual
//               . a insercao da token na fila de espera respeitara a seguinte condicao: ela sera
//                 colocada para execucao antes das tokens de mesma prioridade. Assim, dentro das
//                   tokens de mesma prioridade ela sera a primeira a ser servida.
//               . coloca a token que chama a preempo em servico
//               . retorna 0, pois a token foi colocada em servio
// */
//
//  if ( fct-&gt;f_n_busy_serv &lt; fct-&gt;f_n_serv )   /* Ainda tem servidor livre */
//  {
//          srv = fct-&gt;f_serv;
//          while (srv-&gt;fs_tkn != 0)
//          {
//              srv=srv-&gt;fs_next;
//          }
//          srv-&gt;fs_tkn = tkn;
//          srv-&gt;fs_p_tkn = pri;
//          srv-&gt;fs_start = clock;              /* Comeco de novo servico */
//          fct-&gt;f_n_busy_serv++;
//          r = 0;
//          return (r);
//  }
//
//  /* Se ele chegar aqui siginifica que a Facility esta busy - assim deve-se
//     verificar os servidores que estao ocupados para verificar prioridade da
//     token em servico e efetuar os processamentos 2.a ou 2.b */
//
//  srv = fct-&gt;f_serv;
//  srv_menor_pri = NULL;
//  menor_pri = pri;
//  while (srv != NULL)
//  {
//      if (menor_pri &gt; srv-&gt;fs_p_tkn)
//      {
//          menor_pri = srv-&gt;fs_p_tkn;
//          srv_menor_pri = srv;
//      }
//      srv=srv-&gt;fs_next;
//  }
//
//  if (srv_menor_pri == NULL)          /* Processamento 2.a inicio */
//
//  /* Significa que ele nao achou um servidor com tkn em servico com prioridade menor
//     do que a token que chama a preempo. Ou seja, as tokens tem prioridade maior ou igual a token que chama a preempo.
//     No haver, pois, suspenso de tokens em servio.*/
//  {
//      /*(Comentrio:  Sergio Brito) Neste ponto discordo do MacDougall pois ele diz que, para a token que chama a preempo, se forem achados
//        servidores com token em servico com prioridade maior ou igual  dessa, a token que chama a preempo deve ser
//        enfileirada como  feito em um request tradicional (deve ficar atrs, na fila, de tokens com mesma prioridade).
//        Eu acho que ela deve ser enfileirada com o mesmo esquema de prioridade que eh feito no caso 2.b, assim ao
//        inves de usar a funcao - enqueuep(f, tkn, tkp, pri, te, ev); - deve usar a funcao: enqueuep_preempt */
//      /* O problema aqui  que, assim, a token que no causou preempo vai para fila  frente de outras tokens de mesma
//         prioridade... isso  desejvel?  O comportamento neste caso assemelha-se a elevao da prioridade da token que chamou a funo
//         (08.Jan.2006 Marcos Portnoi)*/
//      /* Faamos como o MacDougall:  colocar a token bloqueada aps as tokens de mesma prioridade
//      enqueuep_preempt(f, tkn, tkp, pri, te, ev);*/
//      enqueuep(f, tkn, tkp, pri, te, ev); //coloca a token em fila em ordem de prioridade, aps as tokens de mesma prioridade
//      r = 1;
//      return (r);
//  }                           /* Processamento 2.a final */
//
//  srv = srv_menor_pri;        /* Processamento 2.b inicio:  aqui, efetivamente, haver preempo (suspenso de token em servio) */
//
//  /* faz o servidor atual ser o com tkn de menor prioridade */
//  /* retira a token da cadeia de eventos com o tempo de termino de servico
//     deve retornar apos o processamento o apontador para o elemento da cadeia
//     de eventos que contem as informacoes de processamento da token */
//
//  evc_tkn_srv = cancelp_tkn(srv-&gt;fs_tkn);
//
//  if (evc_tkn_srv == NULL) { //se for NULL, indica que o token no foi encontrado na cadeia de eventos
//      printf(&quot;\nError - preemptp - token to be preempted not found in event chain (possible release event)&quot;);
//      exit(1);
//  }
//
//  /* obtem as informacoes da token em servico para que ela possa ser enfileirada */
//
//  if ( evc_tkn_srv-&gt;ev_tkn != srv-&gt;fs_tkn ) /* Testa se realmente a tkn obtida eh a em srv */
//  {
//      printf (&quot;\nError - preemptp - token removed from event chain is different from token in service&quot;);
//      printf (&quot;\nError - preemptp - token removed from event chain is different from token in service&quot;);
//      exit (1);
//  }
//
//  tkn_srv = evc_tkn_srv-&gt;ev_tkn;
//  tkp_srv = evc_tkn_srv-&gt;ev_tkn_p;
//  te_srv = (evc_tkn_srv-&gt;ev_time - clock);
//  tkn_pri_srv = srv-&gt;fs_p_tkn;
//  ev_srv = evc_tkn_srv-&gt;ev_type;
//
//  /* coloca a token em servico na fila de espera da facility como a primeira que sera
//     servida em relacao as tokens de mesma prioridade */
//
//  enqueuep_preempt(f, tkn_srv, tkp_srv, tkn_pri_srv, te_srv, ev_srv);
//
//  /* atualiza estatisticas do servidor apos saida da tkn que estava em servico */
//  srv-&gt;fs_tkn = 0;
//  srv-&gt;fs_p_tkn = 0;
//    /* srv-&gt;fs_release_count++;nao deve ser contabilizado mais um release pois senao
//       um job criado na fonte seria representado por varios pedacos.
//       Entao, so deve ocorrer a contabilizacao do release, quando ele
//       for retirado de servico pela funcao release.  (Sergio Brito)
//       Observar que o SMPL, do MacDougall, contabiliza o release na suspenso de servio
//        (preempo).  Isso de fato criaria jobs fragmentados.  hmmmmm... (08.Jan.2006 Marcos Portnoi)*/
//  srv-&gt;fs_busy_time = srv-&gt;fs_busy_time + ( clock - srv-&gt;fs_start ); /*Acumula tempo uso serv */
//
//  /* atualiza estatisticas da facility apos saida do servico */
//  fct-&gt;f_busy_time = fct-&gt;f_busy_time + ( clock - srv-&gt;fs_start );
//  /* fct-&gt;f_release_count++; idem srv-&gt;fs_release_cont++ */
//  fct-&gt;f_n_busy_serv--; //agora h um servidor livre
//  fct-&gt;f_preempt_count++; //incrementa contador de preempes, pois aqui efetivamente ocorreu uma
//
//  /* apos a utilizacao de todas as informacoes da token que foi tirada da cadeia e do
//     servico e foi enfileirada na facility, podemos liberar a area de memoria que
//     o elemento da cadeia estava usando */
//
//  free(evc_tkn_srv);
//
//  /* coloca a token que chama a preempo em servico */
//
//  srv-&gt;fs_tkn = tkn;
//  srv-&gt;fs_p_tkn = pri;
//  srv-&gt;fs_start = clock;      /* Comeco de novo servico */
//  fct-&gt;f_n_busy_serv++;
//  r = 0;                      /* retorna 0 pois a solicitacao de servico foi aceita
//                                 para que seja escalonado o termino de servico na
//                                 rotina que a chamou */
//
//  return (r);                 /* Processamento 2.b final */


    // This is from SMPL. Notice the comment and how the remaining service time is artificially set to 1.0e-99 to mark this token as not blocked (just about to be released).
    //else
 //               { /* preempt user of server k.  suspend event, save   */
 //                 /* event number &amp; remaining event time, &amp; enqueue   */
 //                 /* preempted token.  If remaining event time is 0   */
 //                 /* (preemption occurred at the instant release was  */
 //                 /* to occur, set &#39;te&#39; &gt; 0 for proper enqueueing     */
 //                 /* (see &#39;enlist&#39;).  Update facility &amp; server stati- */
 //                 /* stics for the preempted token, and set r = 0 to  */
 //                 /* reserve the facility for the preempting token.   */
 //                 if (tr) then msg(8,tkn,fname(f),2,0);
 //                 j=l1[k]; i=suspend(j); ev=l3[i]; te=l5[i]-clock;
 //                 if (te==0.0) then te=1.0e-99; put_elm(i);
 //                 enqueue(f,j,l2[k],ev,te);
 //                 if (tr) then
 //                   {msg(10,-1,&quot;&quot;,j,l3[f]); msg(12,-1,fname(f),tkn,0);}
 //                 l3[k]++; l4[k]+=clock-l5[k];
 //                 l2[f]--; l4[f+1]++; r=0;

// This is from enlist. Notice that the decision on where to put the enqueued token (in front of tokens of same priority, or after) is
// made based on the remaining service time; if 0.0 (blocked token), put at end; if &gt; 0 (preemted token), put at head.
// I believe, in this simulator, we can make use of a flag (blocked/non-blocked)?
    
    //else
//                    { /* queue: if entry is for a preempted token-    */
//                      /* (l4, the remaining event time, &gt;0), insert   */
//                      /* entry at beginning of its priority class;    */
//                      /* otherwise, insert it at the end              */
//                      if ((v&lt;arg) || ((v==arg) &amp;&amp; (l4[elm]&gt;0.0)))
//                        then break;
}
</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">//* houver preempo e preemptp deve funcionar como um requestp neste caso, ento a token</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment">//* deve ser enfileirada por ordem de prioridade em ao fim das tokens de mesma prioridade</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="comment">//* (deve obedecer ao esquema FIFO dentre a mesma prioridade).  Uma chamada  funo enqueuep,</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment">//* ao invs de enqueuep_preempt, para o caso de no haver preempo, deve resolver a questo.</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment">//* (08.Jan.2006 Marcos Portnoi)</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment">//*</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">//* A funo retorna:</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment">//*  0 se a facility tem servidor disponvel e o token foi colocado em servio;</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">//*  1 se a facility no tem servidor disponvel; token colocada na fila</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">//*  2 se a facility est down (no-operacional); nada foi feito com a token</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">//* O contador de tokens descartados tambm  incrementado para o caso 2.</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">//* (estas ampliaes de estado da facility 10.Jan.2006 Marcos Portnoi)</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">//*/</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment">//int preemptp (int f, int tkn, int pri, int ev, double te, TOKEN *tkp) {</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">//  int r, tkn_srv, tkn_pri_srv, ev_srv, menor_pri;</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">//  struct facilit *fct;</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">//  struct fserv *srv, *srv_menor_pri;</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">//  struct evchain *evc_tkn_srv;</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">//  TOKEN *tkp_srv;</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">//  double te_srv;</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment">//  if ( tkn == 0 )</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">//  {</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">//      printf (&quot;\nError - preemptp - token = 0 &quot;);</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">//      exit (1);</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">//  }</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">//  if ( f &gt; sim[sn].fct_number)</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">//  {</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">//      printf (&quot;\nError - preemptp - facility number does not exist&quot;);</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment">//      exit (1);</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">//  }</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment">//  fct = sim[sn].fct_begin;</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">//  while (fct-&gt;f_number != f)</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">//  {</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">//      fct=fct-&gt;fct_next;</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">//  }</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment">//  //se a facility estiver down, retorne imediatamente com 2</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment">//  //O programa do usurio deve decidir o que fazer com a token (descartar ou no)</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment">//  if (getFacUpStatus(f)==0)</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment">//  {</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment">//      fct-&gt;f_tkn_dropped++; //incremente contador de tokens descartadas; se isso no for interessante para o usurio, ento esta linha deve ser editada</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment">//      return 2;</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment">//  }</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment">//  /*Situacoes possveis na preempo:</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment">//     1. Se tiver servidor livre aloca o servidor com a token e retorna 0 da funcao</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment">//   2. Se todos os servidores estiverem ocupados verifica-se as prioridades das tokens em servico</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="comment">//          a. Se as tokens em servico tiverem prioridade maior ou igual a token que chama a preempo, entao a</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="comment">//             token que chama a preempo eh colocada em fila como qualquer outra token e 1 eh retornado ou seja</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="comment">//               o preempt funciona exatamente como o request.</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="comment">//          b. Se a token em servico tiver prioridade menor que do que a token atual, retira a token</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="comment">//             de servico fazendo todas as atualizacoes necessarias -</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment">//               . retira da cadeia de eventos o termino do servico desta token (caso ela nao encontre</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment">//                 esta token com termino de servico um erro e retornado</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment">//               . acrescenta a utilizacao na facility e no servidor do tempo que ela passou em servico</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment">//                 este tempo eh o clock atual subtraido do tempo em que ela entrou em servico</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment">//                   pois de toda forma ele ja usou os recursos de servico</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment">//               . coloca entao a token retirada em servico na fila de espera onde o tempo que estara</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment">//                 associado ao termino de servico da token e o tempo final de servico do evento</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment">//                   retirado da cadeia de eventos diminuido do clock atual</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment">//               . a insercao da token na fila de espera respeitara a seguinte condicao: ela sera</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment">//                 colocada para execucao antes das tokens de mesma prioridade. Assim, dentro das</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment">//                   tokens de mesma prioridade ela sera a primeira a ser servida.</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment">//               . coloca a token que chama a preempo em servico</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">//               . retorna 0, pois a token foi colocada em servio // */
//
//  if ( fct-&gt;f_n_busy_serv &lt; fct-&gt;f_n_serv )   /* Ainda tem servidor livre */
//  {
//          srv = fct-&gt;f_serv;
//          while (srv-&gt;fs_tkn != 0)
//          {
//              srv=srv-&gt;fs_next;
//          }
//          srv-&gt;fs_tkn = tkn;
//          srv-&gt;fs_p_tkn = pri;
//          srv-&gt;fs_start = clock;              /* Comeco de novo servico */
//          fct-&gt;f_n_busy_serv++;
//          r = 0;
//          return (r);
//  }
//
//  /* Se ele chegar aqui siginifica que a Facility esta busy - assim deve-se
//     verificar os servidores que estao ocupados para verificar prioridade da
//     token em servico e efetuar os processamentos 2.a ou 2.b */
//
//  srv = fct-&gt;f_serv;
//  srv_menor_pri = NULL;
//  menor_pri = pri;
//  while (srv != NULL)
//  {
//      if (menor_pri &gt; srv-&gt;fs_p_tkn)
//      {
//          menor_pri = srv-&gt;fs_p_tkn;
//          srv_menor_pri = srv;
//      }
//      srv=srv-&gt;fs_next;
//  }
//
//  if (srv_menor_pri == NULL)          /* Processamento 2.a inicio */
//
//  /* Significa que ele nao achou um servidor com tkn em servico com prioridade menor
//     do que a token que chama a preempo. Ou seja, as tokens tem prioridade maior ou igual a token que chama a preempo.
//     No haver, pois, suspenso de tokens em servio.*/
//  {
//      /*(Comentrio:  Sergio Brito) Neste ponto discordo do MacDougall pois ele diz que, para a token que chama a preempo, se forem achados
//        servidores com token em servico com prioridade maior ou igual  dessa, a token que chama a preempo deve ser
//        enfileirada como  feito em um request tradicional (deve ficar atrs, na fila, de tokens com mesma prioridade).
//        Eu acho que ela deve ser enfileirada com o mesmo esquema de prioridade que eh feito no caso 2.b, assim ao
//        inves de usar a funcao - enqueuep(f, tkn, tkp, pri, te, ev); - deve usar a funcao: enqueuep_preempt */
//      /* O problema aqui  que, assim, a token que no causou preempo vai para fila  frente de outras tokens de mesma
//         prioridade... isso  desejvel?  O comportamento neste caso assemelha-se a elevao da prioridade da token que chamou a funo
//         (08.Jan.2006 Marcos Portnoi)*/
//      /* Faamos como o MacDougall:  colocar a token bloqueada aps as tokens de mesma prioridade
//      enqueuep_preempt(f, tkn, tkp, pri, te, ev);*/
//      enqueuep(f, tkn, tkp, pri, te, ev); //coloca a token em fila em ordem de prioridade, aps as tokens de mesma prioridade
//      r = 1;
//      return (r);
//  }                           /* Processamento 2.a final */
//
//  srv = srv_menor_pri;        /* Processamento 2.b inicio:  aqui, efetivamente, haver preempo (suspenso de token em servio) */
//
//  /* faz o servidor atual ser o com tkn de menor prioridade */
//  /* retira a token da cadeia de eventos com o tempo de termino de servico
//     deve retornar apos o processamento o apontador para o elemento da cadeia
//     de eventos que contem as informacoes de processamento da token */
//
//  evc_tkn_srv = cancelp_tkn(srv-&gt;fs_tkn);
//
//  if (evc_tkn_srv == NULL) { //se for NULL, indica que o token no foi encontrado na cadeia de eventos
//      printf(&quot;\nError - preemptp - token to be preempted not found in event chain (possible release event)&quot;);
//      exit(1);
//  }
//
//  /* obtem as informacoes da token em servico para que ela possa ser enfileirada */
//
//  if ( evc_tkn_srv-&gt;ev_tkn != srv-&gt;fs_tkn ) /* Testa se realmente a tkn obtida eh a em srv */
//  {
//      printf (&quot;\nError - preemptp - token removed from event chain is different from token in service&quot;);
//      printf (&quot;\nError - preemptp - token removed from event chain is different from token in service&quot;);
//      exit (1);
//  }
//
//  tkn_srv = evc_tkn_srv-&gt;ev_tkn;
//  tkp_srv = evc_tkn_srv-&gt;ev_tkn_p;
//  te_srv = (evc_tkn_srv-&gt;ev_time - clock);
//  tkn_pri_srv = srv-&gt;fs_p_tkn;
//  ev_srv = evc_tkn_srv-&gt;ev_type;
//
//  /* coloca a token em servico na fila de espera da facility como a primeira que sera
//     servida em relacao as tokens de mesma prioridade */
//
//  enqueuep_preempt(f, tkn_srv, tkp_srv, tkn_pri_srv, te_srv, ev_srv);
//
//  /* atualiza estatisticas do servidor apos saida da tkn que estava em servico */
//  srv-&gt;fs_tkn = 0;
//  srv-&gt;fs_p_tkn = 0;
//    /* srv-&gt;fs_release_count++;nao deve ser contabilizado mais um release pois senao
//       um job criado na fonte seria representado por varios pedacos.
//       Entao, so deve ocorrer a contabilizacao do release, quando ele
//       for retirado de servico pela funcao release.  (Sergio Brito)
//       Observar que o SMPL, do MacDougall, contabiliza o release na suspenso de servio
//        (preempo).  Isso de fato criaria jobs fragmentados.  hmmmmm... (08.Jan.2006 Marcos Portnoi)*/
//  srv-&gt;fs_busy_time = srv-&gt;fs_busy_time + ( clock - srv-&gt;fs_start ); /*Acumula tempo uso serv */
//
//  /* atualiza estatisticas da facility apos saida do servico */
//  fct-&gt;f_busy_time = fct-&gt;f_busy_time + ( clock - srv-&gt;fs_start );
//  /* fct-&gt;f_release_count++; idem srv-&gt;fs_release_cont++ */
//  fct-&gt;f_n_busy_serv--; //agora h um servidor livre
//  fct-&gt;f_preempt_count++; //incrementa contador de preempes, pois aqui efetivamente ocorreu uma
//
//  /* apos a utilizacao de todas as informacoes da token que foi tirada da cadeia e do
//     servico e foi enfileirada na facility, podemos liberar a area de memoria que
//     o elemento da cadeia estava usando */
//
//  free(evc_tkn_srv);
//
//  /* coloca a token que chama a preempo em servico */
//
//  srv-&gt;fs_tkn = tkn;
//  srv-&gt;fs_p_tkn = pri;
//  srv-&gt;fs_start = clock;      /* Comeco de novo servico */
//  fct-&gt;f_n_busy_serv++;
//  r = 0;                      /* retorna 0 pois a solicitacao de servico foi aceita
//                                 para que seja escalonado o termino de servico na
//                                 rotina que a chamou */
//
//  return (r);                 /* Processamento 2.b final */


    // This is from SMPL. Notice the comment and how the remaining service time is artificially set to 1.0e-99 to mark this token as not blocked (just about to be released).
    //else
 //               { /* preempt user of server k.  suspend event, save   */
 //                 /* event number &amp; remaining event time, &amp; enqueue   */
 //                 /* preempted token.  If remaining event time is 0   */
 //                 /* (preemption occurred at the instant release was  */
 //                 /* to occur, set &#39;te&#39; &gt; 0 for proper enqueueing     */
 //                 /* (see &#39;enlist&#39;).  Update facility &amp; server stati- */
 //                 /* stics for the preempted token, and set r = 0 to  */
 //                 /* reserve the facility for the preempting token.   */
 //                 if (tr) then msg(8,tkn,fname(f),2,0);
 //                 j=l1[k]; i=suspend(j); ev=l3[i]; te=l5[i]-clock;
 //                 if (te==0.0) then te=1.0e-99; put_elm(i);
 //                 enqueue(f,j,l2[k],ev,te);
 //                 if (tr) then
 //                   {msg(10,-1,&quot;&quot;,j,l3[f]); msg(12,-1,fname(f),tkn,0);}
 //                 l3[k]++; l4[k]+=clock-l5[k];
 //                 l2[f]--; l4[f+1]++; r=0;

// This is from enlist. Notice that the decision on where to put the enqueued token (in front of tokens of same priority, or after) is
// made based on the remaining service time; if 0.0 (blocked token), put at end; if &gt; 0 (preemted token), put at head.
// I believe, in this simulator, we can make use of a flag (blocked/non-blocked)?
    
    //else
//                    { /* queue: if entry is for a preempted token-    */
//                      /* (l4, the remaining event time, &gt;0), insert   */
//                      /* entry at beginning of its priority class;    */
//                      /* otherwise, insert it at the end              */
//                      if ((v&lt;arg) || ((v==arg) &amp;&amp; (l4[elm]&gt;0.0)))
//                        then break;
}
</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">//  */</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment">//  if ( fct-&gt;f_n_busy_serv &lt; fct-&gt;f_n_serv )   /* Ainda tem servidor livre */</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment">//  {</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment">//          srv = fct-&gt;f_serv;</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment">//          while (srv-&gt;fs_tkn != 0)</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment">//          {</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment">//              srv=srv-&gt;fs_next;</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment">//          }</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment">//          srv-&gt;fs_tkn = tkn;</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment">//          srv-&gt;fs_p_tkn = pri;</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment">//          srv-&gt;fs_start = clock;              /* Comeco de novo servico */</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment">//          fct-&gt;f_n_busy_serv++;</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment">//          r = 0;</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment">//          return (r);</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment">//  }</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment">//  /* Se ele chegar aqui siginifica que a Facility esta busy - assim deve-se</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">//     verificar os servidores que estao ocupados para verificar prioridade da</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">//     token em servico e efetuar os processamentos 2.a ou 2.b */</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment">//  srv = fct-&gt;f_serv;</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment">//  srv_menor_pri = NULL;</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment">//  menor_pri = pri;</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment">//  while (srv != NULL)</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment">//  {</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment">//      if (menor_pri &gt; srv-&gt;fs_p_tkn)</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment">//      {</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment">//          menor_pri = srv-&gt;fs_p_tkn;</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="comment">//          srv_menor_pri = srv;</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="comment">//      }</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="comment">//      srv=srv-&gt;fs_next;</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment">//  }</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment">//  if (srv_menor_pri == NULL)          /* Processamento 2.a inicio */</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="comment">//  /* Significa que ele nao achou um servidor com tkn em servico com prioridade menor</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="comment">//     do que a token que chama a preempo. Ou seja, as tokens tem prioridade maior ou igual a token que chama a preempo.</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="comment">//     No haver, pois, suspenso de tokens em servio.*/</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="comment">//  {</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="comment">//      /*(Comentrio:  Sergio Brito) Neste ponto discordo do MacDougall pois ele diz que, para a token que chama a preempo, se forem achados</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment">//        servidores com token em servico com prioridade maior ou igual  dessa, a token que chama a preempo deve ser</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment">//        enfileirada como  feito em um request tradicional (deve ficar atrs, na fila, de tokens com mesma prioridade).</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="comment">//        Eu acho que ela deve ser enfileirada com o mesmo esquema de prioridade que eh feito no caso 2.b, assim ao</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment">//        inves de usar a funcao - enqueuep(f, tkn, tkp, pri, te, ev); - deve usar a funcao: enqueuep_preempt */</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">//      /* O problema aqui  que, assim, a token que no causou preempo vai para fila  frente de outras tokens de mesma</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment">//         prioridade... isso  desejvel?  O comportamento neste caso assemelha-se a elevao da prioridade da token que chamou a funo</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment">//         (08.Jan.2006 Marcos Portnoi)*/</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment">//      /* Faamos como o MacDougall:  colocar a token bloqueada aps as tokens de mesma prioridade</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment">//      enqueuep_preempt(f, tkn, tkp, pri, te, ev);*/</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">//      enqueuep(f, tkn, tkp, pri, te, ev); //coloca a token em fila em ordem de prioridade, aps as tokens de mesma prioridade</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">//      r = 1;</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment">//      return (r);</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="comment">//  }                           /* Processamento 2.a final */</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment">//  srv = srv_menor_pri;        /* Processamento 2.b inicio:  aqui, efetivamente, haver preempo (suspenso de token em servio) */</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="comment">//  /* faz o servidor atual ser o com tkn de menor prioridade */</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment">//  /* retira a token da cadeia de eventos com o tempo de termino de servico</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment">//     deve retornar apos o processamento o apontador para o elemento da cadeia</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment">//     de eventos que contem as informacoes de processamento da token */</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="comment">//  evc_tkn_srv = cancelp_tkn(srv-&gt;fs_tkn);</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="comment">//  if (evc_tkn_srv == NULL) { //se for NULL, indica que o token no foi encontrado na cadeia de eventos</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="comment">//      printf(&quot;\nError - preemptp - token to be preempted not found in event chain (possible release event)&quot;);</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment">//      exit(1);</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="comment">//  }</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="comment">//  /* obtem as informacoes da token em servico para que ela possa ser enfileirada */</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="comment">//  if ( evc_tkn_srv-&gt;ev_tkn != srv-&gt;fs_tkn ) /* Testa se realmente a tkn obtida eh a em srv */</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="comment">//  {</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="comment">//      printf (&quot;\nError - preemptp - token removed from event chain is different from token in service&quot;);</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="comment">//      printf (&quot;\nError - preemptp - token removed from event chain is different from token in service&quot;);</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="comment">//      exit (1);</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="comment">//  }</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment">//  tkn_srv = evc_tkn_srv-&gt;ev_tkn;</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment">//  tkp_srv = evc_tkn_srv-&gt;ev_tkn_p;</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment">//  te_srv = (evc_tkn_srv-&gt;ev_time - clock);</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="comment">//  tkn_pri_srv = srv-&gt;fs_p_tkn;</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="comment">//  ev_srv = evc_tkn_srv-&gt;ev_type;</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="comment">//  /* coloca a token em servico na fila de espera da facility como a primeira que sera</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="comment">//     servida em relacao as tokens de mesma prioridade */</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="comment">//  enqueuep_preempt(f, tkn_srv, tkp_srv, tkn_pri_srv, te_srv, ev_srv);</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="comment">//  /* atualiza estatisticas do servidor apos saida da tkn que estava em servico */</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="comment">//  srv-&gt;fs_tkn = 0;</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="comment">//  srv-&gt;fs_p_tkn = 0;</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="comment">//    /* srv-&gt;fs_release_count++;nao deve ser contabilizado mais um release pois senao</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="comment">//       um job criado na fonte seria representado por varios pedacos.</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="comment">//       Entao, so deve ocorrer a contabilizacao do release, quando ele</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="comment">//       for retirado de servico pela funcao release.  (Sergio Brito)</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="comment">//       Observar que o SMPL, do MacDougall, contabiliza o release na suspenso de servio //        (preempo).  Isso de fato criaria jobs fragmentados.  hmmmmm... (08.Jan.2006 Marcos Portnoi)*/
//  srv-&gt;fs_busy_time = srv-&gt;fs_busy_time + ( clock - srv-&gt;fs_start ); /*Acumula tempo uso serv */
//
//  /* atualiza estatisticas da facility apos saida do servico */
//  fct-&gt;f_busy_time = fct-&gt;f_busy_time + ( clock - srv-&gt;fs_start );
//  /* fct-&gt;f_release_count++; idem srv-&gt;fs_release_cont++ */
//  fct-&gt;f_n_busy_serv--; //agora h um servidor livre
//  fct-&gt;f_preempt_count++; //incrementa contador de preempes, pois aqui efetivamente ocorreu uma
//
//  /* apos a utilizacao de todas as informacoes da token que foi tirada da cadeia e do
//     servico e foi enfileirada na facility, podemos liberar a area de memoria que
//     o elemento da cadeia estava usando */
//
//  free(evc_tkn_srv);
//
//  /* coloca a token que chama a preempo em servico */
//
//  srv-&gt;fs_tkn = tkn;
//  srv-&gt;fs_p_tkn = pri;
//  srv-&gt;fs_start = clock;      /* Comeco de novo servico */
//  fct-&gt;f_n_busy_serv++;
//  r = 0;                      /* retorna 0 pois a solicitacao de servico foi aceita
//                                 para que seja escalonado o termino de servico na
//                                 rotina que a chamou */
//
//  return (r);                 /* Processamento 2.b final */


    // This is from SMPL. Notice the comment and how the remaining service time is artificially set to 1.0e-99 to mark this token as not blocked (just about to be released).
    //else
 //               { /* preempt user of server k.  suspend event, save   */
 //                 /* event number &amp; remaining event time, &amp; enqueue   */
 //                 /* preempted token.  If remaining event time is 0   */
 //                 /* (preemption occurred at the instant release was  */
 //                 /* to occur, set &#39;te&#39; &gt; 0 for proper enqueueing     */
 //                 /* (see &#39;enlist&#39;).  Update facility &amp; server stati- */
 //                 /* stics for the preempted token, and set r = 0 to  */
 //                 /* reserve the facility for the preempting token.   */
 //                 if (tr) then msg(8,tkn,fname(f),2,0);
 //                 j=l1[k]; i=suspend(j); ev=l3[i]; te=l5[i]-clock;
 //                 if (te==0.0) then te=1.0e-99; put_elm(i);
 //                 enqueue(f,j,l2[k],ev,te);
 //                 if (tr) then
 //                   {msg(10,-1,&quot;&quot;,j,l3[f]); msg(12,-1,fname(f),tkn,0);}
 //                 l3[k]++; l4[k]+=clock-l5[k];
 //                 l2[f]--; l4[f+1]++; r=0;

// This is from enlist. Notice that the decision on where to put the enqueued token (in front of tokens of same priority, or after) is
// made based on the remaining service time; if 0.0 (blocked token), put at end; if &gt; 0 (preemted token), put at head.
// I believe, in this simulator, we can make use of a flag (blocked/non-blocked)?
    
    //else
//                    { /* queue: if entry is for a preempted token-    */
//                      /* (l4, the remaining event time, &gt;0), insert   */
//                      /* entry at beginning of its priority class;    */
//                      /* otherwise, insert it at the end              */
//                      if ((v&lt;arg) || ((v==arg) &amp;&amp; (l4[elm]&gt;0.0)))
//                        then break;
}
</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;<span class="comment">//       (preempo).  Isso de fato criaria jobs fragmentados.  hmmmmm... (08.Jan.2006 Marcos Portnoi)*/</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="comment">//  srv-&gt;fs_busy_time = srv-&gt;fs_busy_time + ( clock - srv-&gt;fs_start ); /*Acumula tempo uso serv */</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="comment">//  /* atualiza estatisticas da facility apos saida do servico */</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="comment">//  fct-&gt;f_busy_time = fct-&gt;f_busy_time + ( clock - srv-&gt;fs_start );</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="comment">//  /* fct-&gt;f_release_count++; idem srv-&gt;fs_release_cont++ */</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="comment">//  fct-&gt;f_n_busy_serv--; //agora h um servidor livre</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="comment">//  fct-&gt;f_preempt_count++; //incrementa contador de preempes, pois aqui efetivamente ocorreu uma</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment">//  /* apos a utilizacao de todas as informacoes da token que foi tirada da cadeia e do</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="comment">//     servico e foi enfileirada na facility, podemos liberar a area de memoria que</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="comment">//     o elemento da cadeia estava usando */</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="comment">//  free(evc_tkn_srv);</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="comment">//  /* coloca a token que chama a preempo em servico */</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment">//  srv-&gt;fs_tkn = tkn;</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment">//  srv-&gt;fs_p_tkn = pri;</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="comment">//  srv-&gt;fs_start = clock;      /* Comeco de novo servico */</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="comment">//  fct-&gt;f_n_busy_serv++;</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="comment">//  r = 0;                      /* retorna 0 pois a solicitacao de servico foi aceita</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="comment">//                                 para que seja escalonado o termino de servico na</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="comment">//                                 rotina que a chamou */</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="comment">//  return (r);                 /* Processamento 2.b final */</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="comment">// This is from SMPL. Notice the comment and how the remaining service time is artificially set to 1.0e-99 to mark this token as not blocked (just about to be released).</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="comment">//else</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160; <span class="comment">//               { /* preempt user of server k.  suspend event, save   */</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160; <span class="comment">//                 /* event number &amp; remaining event time, &amp; enqueue   */</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160; <span class="comment">//                 /* preempted token.  If remaining event time is 0   */</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160; <span class="comment">//                 /* (preemption occurred at the instant release was  */</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160; <span class="comment">//                 /* to occur, set &#39;te&#39; &gt; 0 for proper enqueueing     */</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160; <span class="comment">//                 /* (see &#39;enlist&#39;).  Update facility &amp; server stati- */</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160; <span class="comment">//                 /* stics for the preempted token, and set r = 0 to  */</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160; <span class="comment">//                 /* reserve the facility for the preempting token.   */</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160; <span class="comment">//                 if (tr) then msg(8,tkn,fname(f),2,0);</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160; <span class="comment">//                 j=l1[k]; i=suspend(j); ev=l3[i]; te=l5[i]-clock;</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160; <span class="comment">//                 if (te==0.0) then te=1.0e-99; put_elm(i);</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160; <span class="comment">//                 enqueue(f,j,l2[k],ev,te);</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160; <span class="comment">//                 if (tr) then</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160; <span class="comment">//                   {msg(10,-1,&quot;&quot;,j,l3[f]); msg(12,-1,fname(f),tkn,0);}</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160; <span class="comment">//                 l3[k]++; l4[k]+=clock-l5[k];</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160; <span class="comment">//                 l2[f]--; l4[f+1]++; r=0;</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="comment">// This is from enlist. Notice that the decision on where to put the enqueued token (in front of tokens of same priority, or after) is</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="comment">// made based on the remaining service time; if 0.0 (blocked token), put at end; if &gt; 0 (preemted token), put at head.</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="comment">// I believe, in this simulator, we can make use of a flag (blocked/non-blocked)?</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    </div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <span class="comment">//else</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="comment">//                    { /* queue: if entry is for a preempted token-    */</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="comment">//                      /* (l4, the remaining event time, &gt;0), insert   */</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="comment">//                      /* entry at beginning of its priority class;    */</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="comment">//                      /* otherwise, insert it at the end              */</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="comment">//                      if ((v&lt;arg) || ((v==arg) &amp;&amp; (l4[elm]&gt;0.0)))</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="comment">//                        then break;</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;}</div>
<div class="ttc" id="class_facility_html_ae813c0db5554a9827600e10cfc863748"><div class="ttname"><a href="class_facility.html#ae813c0db5554a9827600e10cfc863748">Facility::requestsPreemptsCount</a></div><div class="ttdeci">unsigned int requestsPreemptsCount</div><div class="ttdoc">Count of number of service requests and preemptions made to this facility (regardless of the outcome)...</div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00067">Facility.h:67</a></div></div>
<div class="ttc" id="_facility_return_type_8h_html_a4ebe26bb7c3ad3b1926de74522fcc72ca3e860a081575fc82cc7b6ed2ca602947"><div class="ttname"><a href="_facility_return_type_8h.html#a4ebe26bb7c3ad3b1926de74522fcc72ca3e860a081575fc82cc7b6ed2ca602947">FacilityReturnType::NOT_IMPLEMENTED</a></div><div class="ttdoc">This function has not been implemented yet. </div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac92cceb40d15ff27039f16ee83b8431a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int Facility::purgeQueue </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Purge queue, return number of dropped elements. </p>
<p>Purge queue, update statistics, return number of dropped elements (tokens).</p>
<dl class="section return"><dt>Returns</dt><dd>Number of tokens dropped from queue. </dd></dl>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00194">194</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                                  {</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="comment">// Drop each token in the queue and update statistics.</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="comment">// Technically, statistics only have to be updated for the first element, since all others will result in zero delta</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="comment">// added to the statistics.  Let&#39;s leave the whole iteration here, however, for future implementations.</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> droppedTokensHere = 0; <span class="comment">// Tokens actually dropped from queue. (This is simply the current queue.size(), but let&#39;s count for debugging purposes.)</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="class_facility.html#a4d45a968945045e44ea59be18dff74d1">queue</a>.size() &gt; 0) {</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        <a class="code" href="class_facility.html#a6ef416b0d1a9ce5b719dc6499b16fa4b">sumLengthTimeProduct</a> += <a class="code" href="class_facility.html#a4d45a968945045e44ea59be18dff74d1">queue</a>.size() * (<a class="code" href="class_facility.html#a04cb8b8f3d633cfcf6ba1603f5dfe7ad">simulatorGlobals</a>.<a class="code" href="class_simulator_globals.html#a08da82e86d7c26d8f2498bd313f0e66e">getCurrentAbsoluteTime</a>() - <a class="code" href="class_facility.html#a2ecb5a0b0cc18479325d6c3a963972a2">lastQueueChangeTime</a>); <span class="comment">// For subsequent tokens, this will be a zero delta!</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        <span class="comment">// Discarded token, not dequeued token.  Then, do not update dequeued token counter.</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        <span class="comment">//dequeuedTokensCount--;</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        ++<a class="code" href="class_facility.html#ab527ba2778f17a4068266fd8b522ec35">droppedTokensCount</a>; <span class="comment">// Update dropped token counter.</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <a class="code" href="class_facility.html#a2ecb5a0b0cc18479325d6c3a963972a2">lastQueueChangeTime</a> = <a class="code" href="class_facility.html#a04cb8b8f3d633cfcf6ba1603f5dfe7ad">simulatorGlobals</a>.<a class="code" href="class_simulator_globals.html#a08da82e86d7c26d8f2498bd313f0e66e">getCurrentAbsoluteTime</a>();</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        <a class="code" href="class_facility.html#a4d45a968945045e44ea59be18dff74d1">queue</a>.pop_front(); <span class="comment">// Remove token in front of queue.</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        ++droppedTokensHere;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    }</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordflow">return</span> droppedTokensHere;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;} </div>
<div class="ttc" id="class_facility_html_ab527ba2778f17a4068266fd8b522ec35"><div class="ttname"><a href="class_facility.html#ab527ba2778f17a4068266fd8b522ec35">Facility::droppedTokensCount</a></div><div class="ttdeci">unsigned int droppedTokensCount</div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00062">Facility.h:62</a></div></div>
<div class="ttc" id="class_facility_html_a4d45a968945045e44ea59be18dff74d1"><div class="ttname"><a href="class_facility.html#a4d45a968945045e44ea59be18dff74d1">Facility::queue</a></div><div class="ttdeci">std::list&lt; FacilityQueueElement &gt; queue</div><div class="ttdoc">Priority queue of tokens in this facility. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00060">Facility.h:60</a></div></div>
<div class="ttc" id="class_facility_html_a04cb8b8f3d633cfcf6ba1603f5dfe7ad"><div class="ttname"><a href="class_facility.html#a04cb8b8f3d633cfcf6ba1603f5dfe7ad">Facility::simulatorGlobals</a></div><div class="ttdeci">SimulatorGlobals &amp; simulatorGlobals</div><div class="ttdoc">Reference to SimulatorGlobals object (typically used to fetch the current clock time). </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00065">Facility.h:65</a></div></div>
<div class="ttc" id="class_simulator_globals_html_a08da82e86d7c26d8f2498bd313f0e66e"><div class="ttname"><a href="class_simulator_globals.html#a08da82e86d7c26d8f2498bd313f0e66e">SimulatorGlobals::getCurrentAbsoluteTime</a></div><div class="ttdeci">double getCurrentAbsoluteTime() const </div><div class="ttdef"><b>Definition:</b> <a href="_simulator_globals_8cpp_source.html#l00070">SimulatorGlobals.cpp:70</a></div></div>
<div class="ttc" id="class_facility_html_a2ecb5a0b0cc18479325d6c3a963972a2"><div class="ttname"><a href="class_facility.html#a2ecb5a0b0cc18479325d6c3a963972a2">Facility::lastQueueChangeTime</a></div><div class="ttdeci">double lastQueueChangeTime</div><div class="ttdoc">Absolute time of last queue change. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00054">Facility.h:54</a></div></div>
<div class="ttc" id="class_facility_html_a6ef416b0d1a9ce5b719dc6499b16fa4b"><div class="ttname"><a href="class_facility.html#a6ef416b0d1a9ce5b719dc6499b16fa4b">Facility::sumLengthTimeProduct</a></div><div class="ttdeci">double sumLengthTimeProduct</div><div class="ttdoc">+= Current queue size * (currentAbsoluteTime - absolute time of last queue change); used to obtain av...</div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00057">Facility.h:57</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af3c20895dff840f8db94350070360e70"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_facility_return_type_8h.html#a4ebe26bb7c3ad3b1926de74522fcc72c">FacilityReturnType</a> Facility::release </td>
          <td>(</td>
          <td class="paramtype">std::shared_ptr&lt; const <a class="el" href="class_token.html">Token</a> &gt;&#160;</td>
          <td class="paramname"><em>token</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Releases a token from service at a facility.</p>
<p>Searches the list of servers for the one servicing the token passed as argument. Once found, updates statistics and status for that server. Checks queue: if not empty, schedules a request event for the token at the head of the queue (and the event is put at the head of the event chain). If no server is found with the argument token, then we have reached an error condition: a release event should not exist for a token not in service. This could happen if the token was preempted, and the release event was not properly removed from the event chain.</p>
<p>Notice that the dequeue procedure for the token queue is done entirely here.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">token</td><td><a class="el" href="class_token.html" title="Token class. ">Token</a> object to be released from service. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00586">586</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                                                                     {</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    std::vector&lt;FacilityServer&gt;::iterator serversIterator;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    </div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="comment">// Iterate through the servers in this facility to find which one has the token.</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    serversIterator = <a class="code" href="class_facility.html#a0519eef6d28a92c9b7a7d6a3bc9db31a">servers</a>.begin();</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="keywordflow">while</span> (serversIterator != <a class="code" href="class_facility.html#a0519eef6d28a92c9b7a7d6a3bc9db31a">servers</a>.end()) {</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        <span class="keywordflow">if</span> (serversIterator-&gt;isBusy == <span class="keyword">true</span> &amp;&amp; serversIterator-&gt;token == token) {</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;            <span class="comment">// Found busy server with the token. Let&#39;s release and update statistics.</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;            serversIterator-&gt;isBusy = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;            serversIterator-&gt;token.reset(); <span class="comment">// One less reference to the token, i.e., server down not &quot;own&quot; token anymore.</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;            ++serversIterator-&gt;releasedTokensCount;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;            serversIterator-&gt;sumBusyTime += <a class="code" href="class_facility.html#a04cb8b8f3d633cfcf6ba1603f5dfe7ad">simulatorGlobals</a>.<a class="code" href="class_simulator_globals.html#a08da82e86d7c26d8f2498bd313f0e66e">getCurrentAbsoluteTime</a>() - serversIterator-&gt;serviceStartTime; <span class="comment">// Acumulates busy time for this server.</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;            <span class="comment">// Update facility&#39;s statistics.</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;            this-&gt;<a class="code" href="class_facility.html#ad85ff7fec4ac7166046cd65a80575def">sumBusyTime</a> += <a class="code" href="class_facility.html#a04cb8b8f3d633cfcf6ba1603f5dfe7ad">simulatorGlobals</a>.<a class="code" href="class_simulator_globals.html#a08da82e86d7c26d8f2498bd313f0e66e">getCurrentAbsoluteTime</a>() - serversIterator-&gt;serviceStartTime; <span class="comment">// Acumulates busy time for facility.</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;            ++<a class="code" href="class_facility.html#a380f50651e6227b6f54ad20a020dba82">releasedTokensCount</a>;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;            <span class="comment">// Now check queue. If true, then there was a token in queue and service request will be scheduled for it.</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="class_facility.html#ac1fb937bffd1530a130b68f7828a5d57">dequeue</a>()) {</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="_facility_return_type_8h.html#a4ebe26bb7c3ad3b1926de74522fcc72ca04f0f2f8c5f1d22723ec42583abc2a62">FacilityReturnType::TOKEN_RELEASED_DEQUEUED_SERVICE_EVENT_SCHEDULED</a>; <span class="comment">// Done, token at head of queue will be put into service at next event.</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;            }</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;            <span class="comment">// If false, queue was empty. Facility is now free, nothing scheduled for it.</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="_facility_return_type_8h.html#a4ebe26bb7c3ad3b1926de74522fcc72ca17379babaeddb821d94ba820f26beb5a">FacilityReturnType::TOKEN_RELEASED_QUEUE_EMPTY</a>;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        } <span class="comment">// Did not find server yet with token. Continue.</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        ++serversIterator;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    } <span class="comment">// Did not find this token in service in any server. Error (?).</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;\nError - release - token not found in service at this facility.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <span class="comment">//exit(1);</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_facility_return_type_8h.html#a4ebe26bb7c3ad3b1926de74522fcc72cae4016c2451222999836eb27bb5122720">FacilityReturnType::TOKEN_NOT_FOUND</a>; <span class="comment">// This is an error condition (not consistent)! Treat appropriately.</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;}</div>
<div class="ttc" id="class_facility_html_ac1fb937bffd1530a130b68f7828a5d57"><div class="ttname"><a href="class_facility.html#ac1fb937bffd1530a130b68f7828a5d57">Facility::dequeue</a></div><div class="ttdeci">bool dequeue()</div><div class="ttdef"><b>Definition:</b> <a href="_facility_8cpp_source.html#l00174">Facility.cpp:174</a></div></div>
<div class="ttc" id="_facility_return_type_8h_html_a4ebe26bb7c3ad3b1926de74522fcc72ca04f0f2f8c5f1d22723ec42583abc2a62"><div class="ttname"><a href="_facility_return_type_8h.html#a4ebe26bb7c3ad3b1926de74522fcc72ca04f0f2f8c5f1d22723ec42583abc2a62">FacilityReturnType::TOKEN_RELEASED_DEQUEUED_SERVICE_EVENT_SCHEDULED</a></div><div class="ttdoc">Token was released from service; token queue was not empty, token at head of queue was scheduled for ...</div></div>
<div class="ttc" id="class_facility_html_a04cb8b8f3d633cfcf6ba1603f5dfe7ad"><div class="ttname"><a href="class_facility.html#a04cb8b8f3d633cfcf6ba1603f5dfe7ad">Facility::simulatorGlobals</a></div><div class="ttdeci">SimulatorGlobals &amp; simulatorGlobals</div><div class="ttdoc">Reference to SimulatorGlobals object (typically used to fetch the current clock time). </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00065">Facility.h:65</a></div></div>
<div class="ttc" id="class_simulator_globals_html_a08da82e86d7c26d8f2498bd313f0e66e"><div class="ttname"><a href="class_simulator_globals.html#a08da82e86d7c26d8f2498bd313f0e66e">SimulatorGlobals::getCurrentAbsoluteTime</a></div><div class="ttdeci">double getCurrentAbsoluteTime() const </div><div class="ttdef"><b>Definition:</b> <a href="_simulator_globals_8cpp_source.html#l00070">SimulatorGlobals.cpp:70</a></div></div>
<div class="ttc" id="_facility_return_type_8h_html_a4ebe26bb7c3ad3b1926de74522fcc72ca17379babaeddb821d94ba820f26beb5a"><div class="ttname"><a href="_facility_return_type_8h.html#a4ebe26bb7c3ad3b1926de74522fcc72ca17379babaeddb821d94ba820f26beb5a">FacilityReturnType::TOKEN_RELEASED_QUEUE_EMPTY</a></div><div class="ttdoc">Token was released from service. No token in queue for servicing. </div></div>
<div class="ttc" id="class_facility_html_a0519eef6d28a92c9b7a7d6a3bc9db31a"><div class="ttname"><a href="class_facility.html#a0519eef6d28a92c9b7a7d6a3bc9db31a">Facility::servers</a></div><div class="ttdeci">std::vector&lt; FacilityServer &gt; servers</div><div class="ttdoc">List of servers in this facility. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00059">Facility.h:59</a></div></div>
<div class="ttc" id="_facility_return_type_8h_html_a4ebe26bb7c3ad3b1926de74522fcc72cae4016c2451222999836eb27bb5122720"><div class="ttname"><a href="_facility_return_type_8h.html#a4ebe26bb7c3ad3b1926de74522fcc72cae4016c2451222999836eb27bb5122720">FacilityReturnType::TOKEN_NOT_FOUND</a></div><div class="ttdoc">Token was not found (typically for release) in this facility (service or queue). This is an error con...</div></div>
<div class="ttc" id="class_facility_html_a380f50651e6227b6f54ad20a020dba82"><div class="ttname"><a href="class_facility.html#a380f50651e6227b6f54ad20a020dba82">Facility::releasedTokensCount</a></div><div class="ttdeci">unsigned int releasedTokensCount</div><div class="ttdoc">Count of processes which were served (released) by facility. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00058">Facility.h:58</a></div></div>
<div class="ttc" id="class_facility_html_ad85ff7fec4ac7166046cd65a80575def"><div class="ttname"><a href="class_facility.html#ad85ff7fec4ac7166046cd65a80575def">Facility::sumBusyTime</a></div><div class="ttdeci">double sumBusyTime</div><div class="ttdoc">Total (relative, elapsed) time this facility was busy. Sum (integral) of busy time of all this facili...</div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00055">Facility.h:55</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad8579e469df0909ad36ee6b0719a2173"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_facility_return_type_8h.html#a4ebe26bb7c3ad3b1926de74522fcc72c">FacilityReturnType</a> Facility::request </td>
          <td>(</td>
          <td class="paramtype">std::shared_ptr&lt; const <a class="el" href="class_token.html">Token</a> &gt;&#160;</td>
          <td class="paramname"><em>token</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_event_type_8h.html#a2628ea8d12e8b2563c32f05dc7fff6fa">EventType</a>&#160;</td>
          <td class="paramname"><em>eventType</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000009">Todo:</a></b></dt><dd>Dequeued tokens will be placed at front of event chain, with corresponding event, such that service time can be calculated real time... this is why we need EventType here. </dd></dl>
<p>Request service for a token at this facility.</p>
<p>Receives a token and requests service for it. Searches for a free server within this facility, and, if found, puts the token into service in this (first found) free server. There are three possible cases:</p>
<p>(1) <a class="el" href="class_facility.html" title="Facility class. ">Facility</a> is down: if the facility is down, the token is not put into service, and the dropped tokens counter is updated. Hence, the token is considered dropped (but it is not actually dropped in this function). Returns FACILITY_DOWN_TOKEN_DROPPED.</p>
<p>(2) No free server was found: if no free server was found in the facility, then then token in enqueued with the current (received) event type and 0.0 as service time (that indicates a blocked (not preempted) token). Returns FACILITY_BUSY_TOKEN_ENQUEUED.</p>
<p>(3) <a class="el" href="class_token.html" title="Token class. ">Token</a> put into service: the list of servers is searched from beginning to end. Once a free server is found, the token is put into service there, and the corresponding start of service time and other server member variables are updated. Returns TOKEN_PUT_INTO_SERVICE.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">token</td><td><a class="el" href="class_token.html" title="Token class. ">Token</a> object for which service is requested. </td></tr>
    <tr><td class="paramname">eventType</td><td><a class="el" href="class_event.html" title="Event class. ">Event</a> type of the event that requested service for this token (necessary for enqueing the token, and later scheduling a new request for the dequeued token). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Return type or result of this token (whether the token was enqueued, put into service, etc.). </dd></dl>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00231">231</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                                                                                          {</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    std::vector&lt;FacilityServer&gt;::iterator serversIterator;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="comment">// Increment request count.</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    ++<a class="code" href="class_facility.html#ae813c0db5554a9827600e10cfc863748">requestsPreemptsCount</a>;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="comment">// If facility is down, token should be discarded, and statistics, updated.</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="class_facility.html#a79363e2f35ebed14de6cf7b34bb96ecf">isUp_</a>) {</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        ++<a class="code" href="class_facility.html#ab527ba2778f17a4068266fd8b522ec35">droppedTokensCount</a>; <span class="comment">// Increment dropped tokens counter.</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="_facility_return_type_8h.html#a4ebe26bb7c3ad3b1926de74522fcc72caeccec682378d2895857cde4b04dd58e1">FacilityReturnType::FACILITY_DOWN_TOKEN_DROPPED</a>;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    }</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="comment">// Get next free server, if any. The return might be an iterator to a free server, or servers.end() if no free server was found.</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    serversIterator = <a class="code" href="class_facility.html#af7ceb3abf7be8d3712d9bb8f9841067c">nextFreeServer</a>();</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="comment">// Check whether the iterator points to servers.end(), which, in this case, means there are not free servers and token  must be enqueued.</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordflow">if</span> (serversIterator == <a class="code" href="class_facility.html#a0519eef6d28a92c9b7a7d6a3bc9db31a">servers</a>.end()) {</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="class_facility.html#a4d45a968945045e44ea59be18dff74d1">queue</a>.size() &lt; <a class="code" href="class_facility.html#a1c5d07b106f295750da83ef6d31f7c34">queueSizeLimit</a>) { <span class="comment">// Only enqueue if queue is below size limit.</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            <a class="code" href="class_facility.html#ae701c2c3665891baa6929ef67ebd755b">enqueue</a>(token, eventType, 0.0, <span class="keyword">false</span>); <span class="comment">// Enqueue with 0.0 and false, indicating this is a blocked token (not preempted).</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="_facility_return_type_8h.html#a4ebe26bb7c3ad3b1926de74522fcc72ca9eabb9b43310855334df811fd9c79748">FacilityReturnType::FACILITY_BUSY_TOKEN_ENQUEUED</a>;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        } <span class="keywordflow">else</span> { <span class="comment">// Facility was busy and queue has reached capacity; drop token.</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;            ++<a class="code" href="class_facility.html#ab527ba2778f17a4068266fd8b522ec35">droppedTokensCount</a>;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="_facility_return_type_8h.html#a4ebe26bb7c3ad3b1926de74522fcc72ca29752595827eef50aabead37d4eb7761">FacilityReturnType::FACILITY_BUSY_QUEUE_FULL_TOKEN_DROPPED</a>;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        }</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        <span class="comment">// Put token into service in this server.</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        serversIterator-&gt;token = token;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        serversIterator-&gt;serviceStartTime = <a class="code" href="class_facility.html#a04cb8b8f3d633cfcf6ba1603f5dfe7ad">simulatorGlobals</a>.<a class="code" href="class_simulator_globals.html#a08da82e86d7c26d8f2498bd313f0e66e">getCurrentAbsoluteTime</a>(); <span class="comment">// Update start of service.</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        serversIterator-&gt;isBusy = <span class="keyword">true</span>; <span class="comment">// Mark this server as busy.</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="_facility_return_type_8h.html#a4ebe26bb7c3ad3b1926de74522fcc72ca748fbb782cdc23671570937bca42c031">FacilityReturnType::TOKEN_PUT_IN_SERVICE</a>;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    }</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;}</div>
<div class="ttc" id="_facility_return_type_8h_html_a4ebe26bb7c3ad3b1926de74522fcc72caeccec682378d2895857cde4b04dd58e1"><div class="ttname"><a href="_facility_return_type_8h.html#a4ebe26bb7c3ad3b1926de74522fcc72caeccec682378d2895857cde4b04dd58e1">FacilityReturnType::FACILITY_DOWN_TOKEN_DROPPED</a></div><div class="ttdoc">Facility is down. Token was dropped (or enqueued, depending on the implementation of function Facilit...</div></div>
<div class="ttc" id="class_facility_html_ab527ba2778f17a4068266fd8b522ec35"><div class="ttname"><a href="class_facility.html#ab527ba2778f17a4068266fd8b522ec35">Facility::droppedTokensCount</a></div><div class="ttdeci">unsigned int droppedTokensCount</div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00062">Facility.h:62</a></div></div>
<div class="ttc" id="class_facility_html_a4d45a968945045e44ea59be18dff74d1"><div class="ttname"><a href="class_facility.html#a4d45a968945045e44ea59be18dff74d1">Facility::queue</a></div><div class="ttdeci">std::list&lt; FacilityQueueElement &gt; queue</div><div class="ttdoc">Priority queue of tokens in this facility. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00060">Facility.h:60</a></div></div>
<div class="ttc" id="class_facility_html_a04cb8b8f3d633cfcf6ba1603f5dfe7ad"><div class="ttname"><a href="class_facility.html#a04cb8b8f3d633cfcf6ba1603f5dfe7ad">Facility::simulatorGlobals</a></div><div class="ttdeci">SimulatorGlobals &amp; simulatorGlobals</div><div class="ttdoc">Reference to SimulatorGlobals object (typically used to fetch the current clock time). </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00065">Facility.h:65</a></div></div>
<div class="ttc" id="class_facility_html_ae813c0db5554a9827600e10cfc863748"><div class="ttname"><a href="class_facility.html#ae813c0db5554a9827600e10cfc863748">Facility::requestsPreemptsCount</a></div><div class="ttdeci">unsigned int requestsPreemptsCount</div><div class="ttdoc">Count of number of service requests and preemptions made to this facility (regardless of the outcome)...</div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00067">Facility.h:67</a></div></div>
<div class="ttc" id="class_facility_html_a1c5d07b106f295750da83ef6d31f7c34"><div class="ttname"><a href="class_facility.html#a1c5d07b106f295750da83ef6d31f7c34">Facility::queueSizeLimit</a></div><div class="ttdeci">unsigned int queueSizeLimit</div><div class="ttdoc">The maximum size the queue can reach (default is std::numeric_limits&amp;lt;unsigned int&amp;gt;::max()); if reache...</div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00052">Facility.h:52</a></div></div>
<div class="ttc" id="class_simulator_globals_html_a08da82e86d7c26d8f2498bd313f0e66e"><div class="ttname"><a href="class_simulator_globals.html#a08da82e86d7c26d8f2498bd313f0e66e">SimulatorGlobals::getCurrentAbsoluteTime</a></div><div class="ttdeci">double getCurrentAbsoluteTime() const </div><div class="ttdef"><b>Definition:</b> <a href="_simulator_globals_8cpp_source.html#l00070">SimulatorGlobals.cpp:70</a></div></div>
<div class="ttc" id="class_facility_html_af7ceb3abf7be8d3712d9bb8f9841067c"><div class="ttname"><a href="class_facility.html#af7ceb3abf7be8d3712d9bb8f9841067c">Facility::nextFreeServer</a></div><div class="ttdeci">std::vector&lt; FacilityServer &gt;::iterator nextFreeServer()</div><div class="ttdef"><b>Definition:</b> <a href="_facility_8cpp_source.html#l00648">Facility.cpp:648</a></div></div>
<div class="ttc" id="_facility_return_type_8h_html_a4ebe26bb7c3ad3b1926de74522fcc72ca29752595827eef50aabead37d4eb7761"><div class="ttname"><a href="_facility_return_type_8h.html#a4ebe26bb7c3ad3b1926de74522fcc72ca29752595827eef50aabead37d4eb7761">FacilityReturnType::FACILITY_BUSY_QUEUE_FULL_TOKEN_DROPPED</a></div><div class="ttdoc">The queue is full (has reached the imposed limit); token for which service was requested was dropped...</div></div>
<div class="ttc" id="_facility_return_type_8h_html_a4ebe26bb7c3ad3b1926de74522fcc72ca748fbb782cdc23671570937bca42c031"><div class="ttname"><a href="_facility_return_type_8h.html#a4ebe26bb7c3ad3b1926de74522fcc72ca748fbb782cdc23671570937bca42c031">FacilityReturnType::TOKEN_PUT_IN_SERVICE</a></div><div class="ttdoc">Token was successfuly put in service by facility. </div></div>
<div class="ttc" id="class_facility_html_a0519eef6d28a92c9b7a7d6a3bc9db31a"><div class="ttname"><a href="class_facility.html#a0519eef6d28a92c9b7a7d6a3bc9db31a">Facility::servers</a></div><div class="ttdeci">std::vector&lt; FacilityServer &gt; servers</div><div class="ttdoc">List of servers in this facility. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00059">Facility.h:59</a></div></div>
<div class="ttc" id="class_facility_html_ae701c2c3665891baa6929ef67ebd755b"><div class="ttname"><a href="class_facility.html#ae701c2c3665891baa6929ef67ebd755b">Facility::enqueue</a></div><div class="ttdeci">void enqueue(std::shared_ptr&lt; const Token &gt; token, EventType eventType, double serviceTime, bool isPreempted)</div><div class="ttdef"><b>Definition:</b> <a href="_facility_8cpp_source.html#l00108">Facility.cpp:108</a></div></div>
<div class="ttc" id="class_facility_html_a79363e2f35ebed14de6cf7b34bb96ecf"><div class="ttname"><a href="class_facility.html#a79363e2f35ebed14de6cf7b34bb96ecf">Facility::isUp_</a></div><div class="ttdeci">bool isUp_</div><div class="ttdoc">Status of facility: true for up (operational), false for down (non-operational). </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00061">Facility.h:61</a></div></div>
<div class="ttc" id="_facility_return_type_8h_html_a4ebe26bb7c3ad3b1926de74522fcc72ca9eabb9b43310855334df811fd9c79748"><div class="ttname"><a href="_facility_return_type_8h.html#a4ebe26bb7c3ad3b1926de74522fcc72ca9eabb9b43310855334df811fd9c79748">FacilityReturnType::FACILITY_BUSY_TOKEN_ENQUEUED</a></div><div class="ttdoc">Facility was busy; token was enqueued. </div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0f7671f75b0309c520692c2a210e734e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int Facility::setDown </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Make facility DOWN.</p>
<p>Also discard all elements from queue and update counters. If this is unwanted, edit the proper function call within.</p>
<dl class="section return"><dt>Returns</dt><dd>Number of discarded tokens. </dd></dl>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00711">711</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;                               {</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <span class="comment">// Purge current queue, update counters. Comment out if this is unwanted.</span></div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <a class="code" href="class_facility.html#a79363e2f35ebed14de6cf7b34bb96ecf">isUp_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_facility.html#ab95ab1d162a591087d3696b9712f7452">dropTokensInService</a>() + <a class="code" href="class_facility.html#ac92cceb40d15ff27039f16ee83b8431a">purgeQueue</a>();</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    </div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;}</div>
<div class="ttc" id="class_facility_html_ab95ab1d162a591087d3696b9712f7452"><div class="ttname"><a href="class_facility.html#ab95ab1d162a591087d3696b9712f7452">Facility::dropTokensInService</a></div><div class="ttdeci">unsigned int dropTokensInService()</div><div class="ttdef"><b>Definition:</b> <a href="_facility_8cpp_source.html#l00967">Facility.cpp:967</a></div></div>
<div class="ttc" id="class_facility_html_ac92cceb40d15ff27039f16ee83b8431a"><div class="ttname"><a href="class_facility.html#ac92cceb40d15ff27039f16ee83b8431a">Facility::purgeQueue</a></div><div class="ttdeci">unsigned int purgeQueue()</div><div class="ttdoc">Purge queue, return number of dropped elements. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8cpp_source.html#l00194">Facility.cpp:194</a></div></div>
<div class="ttc" id="class_facility_html_a79363e2f35ebed14de6cf7b34bb96ecf"><div class="ttname"><a href="class_facility.html#a79363e2f35ebed14de6cf7b34bb96ecf">Facility::isUp_</a></div><div class="ttdeci">bool isUp_</div><div class="ttdoc">Status of facility: true for up (operational), false for down (non-operational). </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00061">Facility.h:61</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad400821aba2cf4489c9b45534c2a42cd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Facility::setName </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Set facility's name. </p>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00793">793</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;                                            {</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    this-&gt;<a class="code" href="class_facility.html#a5967500c415fbf6b3bf420b58e645a6e">name</a> = <a class="code" href="class_facility.html#a5967500c415fbf6b3bf420b58e645a6e">name</a>;</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;}</div>
<div class="ttc" id="class_facility_html_a5967500c415fbf6b3bf420b58e645a6e"><div class="ttname"><a href="class_facility.html#a5967500c415fbf6b3bf420b58e645a6e">Facility::name</a></div><div class="ttdeci">std::string name</div><div class="ttdoc">Facility name. </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00046">Facility.h:46</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4d8bbec743dae89da983619eedb2e129"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Facility::setQueueSizeLimit </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>limit</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Set queue size limit.</p>
<p>When the queue reaches the limit, all subsequent service requests (tokens) will be dropped until the queue size decreases below the limit. Verify behavior for preemption under preempt function description. Default value is std::numeric_limits&lt;unsigned int&gt;::max().</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">limit</td><td>queue size limit as unsigned int. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00938">938</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;                                                   {</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    <a class="code" href="class_facility.html#a1c5d07b106f295750da83ef6d31f7c34">queueSizeLimit</a> = limit;</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;}</div>
<div class="ttc" id="class_facility_html_a1c5d07b106f295750da83ef6d31f7c34"><div class="ttname"><a href="class_facility.html#a1c5d07b106f295750da83ef6d31f7c34">Facility::queueSizeLimit</a></div><div class="ttdeci">unsigned int queueSizeLimit</div><div class="ttdoc">The maximum size the queue can reach (default is std::numeric_limits&amp;lt;unsigned int&amp;gt;::max()); if reache...</div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00052">Facility.h:52</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9cf2c05d0966a731a8a9d9157a13df5e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Facility::setUp </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Make facility UP. </p>

<p>Definition at line <a class="el" href="_facility_8cpp_source.html#l00699">699</a> of file <a class="el" href="_facility_8cpp_source.html">Facility.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                     {</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    <a class="code" href="class_facility.html#a79363e2f35ebed14de6cf7b34bb96ecf">isUp_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;}</div>
<div class="ttc" id="class_facility_html_a79363e2f35ebed14de6cf7b34bb96ecf"><div class="ttname"><a href="class_facility.html#a79363e2f35ebed14de6cf7b34bb96ecf">Facility::isUp_</a></div><div class="ttdeci">bool isUp_</div><div class="ttdoc">Status of facility: true for up (operational), false for down (non-operational). </div><div class="ttdef"><b>Definition:</b> <a href="_facility_8h_source.html#l00061">Facility.h:61</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="ad175b4a1db5abafd76e28c67d81b99a4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int Facility::dequeuedTokensCount</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Count of dequeues up to this moment. </p>

<p>Definition at line <a class="el" href="_facility_8h_source.html#l00053">53</a> of file <a class="el" href="_facility_8h_source.html">Facility.h</a>.</p>

</div>
</div>
<a class="anchor" id="ab527ba2778f17a4068266fd8b522ec35"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int Facility::droppedTokensCount</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Count of discarded or dropped tokens in this facility. When facility enters down state, all tokens in queue are discarded, and this counter is updated. If a token is scheduled for service in a facility, and this facility is down, the token is considered dropped and this counter is also incremented. </p>

<p>Definition at line <a class="el" href="_facility_8h_source.html#l00062">62</a> of file <a class="el" href="_facility_8h_source.html">Facility.h</a>.</p>

</div>
</div>
<a class="anchor" id="a79363e2f35ebed14de6cf7b34bb96ecf"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool Facility::isUp_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Status of facility: true for up (operational), false for down (non-operational). </p>

<p>Definition at line <a class="el" href="_facility_8h_source.html#l00061">61</a> of file <a class="el" href="_facility_8h_source.html">Facility.h</a>.</p>

</div>
</div>
<a class="anchor" id="a2ecb5a0b0cc18479325d6c3a963972a2"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double Facility::lastQueueChangeTime</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Absolute time of last queue change. </p>

<p>Definition at line <a class="el" href="_facility_8h_source.html#l00054">54</a> of file <a class="el" href="_facility_8h_source.html">Facility.h</a>.</p>

</div>
</div>
<a class="anchor" id="aab753210fbc2026ce45e73ec3c86ed75"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int Facility::maxRecordedQueueSize</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Maximum recorded queue size up to this moment. </p>

<p>Definition at line <a class="el" href="_facility_8h_source.html#l00051">51</a> of file <a class="el" href="_facility_8h_source.html">Facility.h</a>.</p>

</div>
</div>
<a class="anchor" id="a5967500c415fbf6b3bf420b58e645a6e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::string Facility::name</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p><a class="el" href="class_facility.html" title="Facility class. ">Facility</a> name. </p>

<p>Definition at line <a class="el" href="_facility_8h_source.html#l00046">46</a> of file <a class="el" href="_facility_8h_source.html">Facility.h</a>.</p>

</div>
</div>
<a class="anchor" id="ab1535255c93b31fe4cf63ecfcd48fc52"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int Facility::preemptedTokensCount</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Count of effective preemptions. </p>

<p>Definition at line <a class="el" href="_facility_8h_source.html#l00056">56</a> of file <a class="el" href="_facility_8h_source.html">Facility.h</a>.</p>

</div>
</div>
<a class="anchor" id="a4d45a968945045e44ea59be18dff74d1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::list&lt;<a class="el" href="class_facility_queue_element.html">FacilityQueueElement</a>&gt; Facility::queue</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Priority queue of tokens in this facility. </p>

<p>Definition at line <a class="el" href="_facility_8h_source.html#l00060">60</a> of file <a class="el" href="_facility_8h_source.html">Facility.h</a>.</p>

</div>
</div>
<a class="anchor" id="a1c5d07b106f295750da83ef6d31f7c34"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int Facility::queueSizeLimit</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The maximum size the queue can reach (default is std::numeric_limits&lt;unsigned int&gt;::max()); if reached, all requests for service will be dropped until queue decreases. Preemptions will be dropped if going into queue (see preempt function). </p>

<p>Definition at line <a class="el" href="_facility_8h_source.html#l00052">52</a> of file <a class="el" href="_facility_8h_source.html">Facility.h</a>.</p>

</div>
</div>
<a class="anchor" id="a380f50651e6227b6f54ad20a020dba82"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int Facility::releasedTokensCount</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Count of processes which were served (released) by facility. </p>

<p>Definition at line <a class="el" href="_facility_8h_source.html#l00058">58</a> of file <a class="el" href="_facility_8h_source.html">Facility.h</a>.</p>

</div>
</div>
<a class="anchor" id="ae813c0db5554a9827600e10cfc863748"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int Facility::requestsPreemptsCount</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Count of number of service requests and preemptions made to this facility (regardless of the outcome). Notice that a token might have more than one request, e.g., if the first request finds a busy facility, token is enqueued. Dequeuing will generated another service request. </p>

<p>Definition at line <a class="el" href="_facility_8h_source.html#l00067">67</a> of file <a class="el" href="_facility_8h_source.html">Facility.h</a>.</p>

</div>
</div>
<a class="anchor" id="a36b590795f3752bd89a4a3ec5fa1307d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_scheduler.html">Scheduler</a>&amp; Facility::scheduler</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reference to <a class="el" href="class_scheduler.html" title="Scheduler class. ">Scheduler</a> object, such that dequeued tokens can be rescheduled. </p>

<p>Definition at line <a class="el" href="_facility_8h_source.html#l00066">66</a> of file <a class="el" href="_facility_8h_source.html">Facility.h</a>.</p>

</div>
</div>
<a class="anchor" id="a0519eef6d28a92c9b7a7d6a3bc9db31a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="class_facility_server.html">FacilityServer</a>&gt; Facility::servers</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>List of servers in this facility. </p>

<p>Definition at line <a class="el" href="_facility_8h_source.html#l00059">59</a> of file <a class="el" href="_facility_8h_source.html">Facility.h</a>.</p>

</div>
</div>
<a class="anchor" id="a04cb8b8f3d633cfcf6ba1603f5dfe7ad"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_simulator_globals.html">SimulatorGlobals</a>&amp; Facility::simulatorGlobals</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reference to <a class="el" href="class_simulator_globals.html" title="Simulator-scope variables and parameters. ">SimulatorGlobals</a> object (typically used to fetch the current clock time). </p>

<p>Definition at line <a class="el" href="_facility_8h_source.html#l00065">65</a> of file <a class="el" href="_facility_8h_source.html">Facility.h</a>.</p>

</div>
</div>
<a class="anchor" id="ad85ff7fec4ac7166046cd65a80575def"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double Facility::sumBusyTime</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Total (relative, elapsed) time this facility was busy. Sum (integral) of busy time of all this facility's servers. </p>

<p>Definition at line <a class="el" href="_facility_8h_source.html#l00055">55</a> of file <a class="el" href="_facility_8h_source.html">Facility.h</a>.</p>

</div>
</div>
<a class="anchor" id="a6ef416b0d1a9ce5b719dc6499b16fa4b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double Facility::sumLengthTimeProduct</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>+= Current queue size * (currentAbsoluteTime - absolute time of last queue change); used to obtain average queue size. </p>

<p>Definition at line <a class="el" href="_facility_8h_source.html#l00057">57</a> of file <a class="el" href="_facility_8h_source.html">Facility.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>QcnSim/<a class="el" href="_facility_8h_source.html">Facility.h</a></li>
<li>QcnSim/<a class="el" href="_facility_8cpp_source.html">Facility.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Nov 14 2013 11:18:23 for QCNSim by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
